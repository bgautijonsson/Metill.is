[
  {
    "objectID": "pyngjan/opinberar_veitingar/index.html",
    "href": "pyngjan/opinberar_veitingar/index.html",
    "title": "Opinberar veitingar",
    "section": "",
    "text": "Á opnirreikningar.is stendur:\nÞað er hægt að leita og fletta upp reikningum á þessari síðu, en ég tók mig bara til og skrifaði R kóða til að sækja gögnin, hreinsa þau aðeins og geyma í PostgreSQL gagnagrunni. Ef þið hafið áhuga á að læra meira um hvernig ég sæki og geymi opinber gögn mun ég reglulega birta greinar um það fyrir áskrifendur að Patreon síðu minni."
  },
  {
    "objectID": "pyngjan/opinberar_veitingar/index.html#rekstraraðilar",
    "href": "pyngjan/opinberar_veitingar/index.html#rekstraraðilar",
    "title": "Opinberar veitingar",
    "section": "Rekstraraðilar",
    "text": "Rekstraraðilar\nTil að fletta upp veitingastöðum þurfum við að leita að fyrirtækjunum sem hjá um reksturinn, ekki veitingastöðunum sjálfum. Ég fékk frábærar hugmyndir frá ykkur á Twitter og framkvæmdi svo smá rannsóknarvinnu til að finna nöfnin á rekstraraðilunum.\n\n\n\n\n \n  \n    Fyrirtæki \n    Veitingastaðir \n  \n \n\n  \n    Pizza-Pizza ehf. \n    Domino's Piza \n  \n  \n    Jómfrúin veitingahús ehf \n    Jómfrúin \n  \n  \n    FoodCo hf. \n    Aktu taktu, Eldsmiðjan, Saffran, Pítan o.fl. \n  \n  \n    KFC ehf. \n    KFC \n  \n  \n    Stjarnan ehf. \n    Subway \n  \n  \n    HALAL ehf. \n    Mandi \n  \n  \n    Hlöllabátar ehf. \n    Hlöllabátar \n  \n  \n    Hamborgarab Tómasar Geirsg ehf \n    Hamborgarabúlla Tómasar \n  \n\n\n\nNokkrir valdir rekstraraðilar og nöfn veitingastaðanna"
  },
  {
    "objectID": "pyngjan/opinberar_veitingar/index.html#árleg-útgjöld-frá-ríkinu",
    "href": "pyngjan/opinberar_veitingar/index.html#árleg-útgjöld-frá-ríkinu",
    "title": "Opinberar veitingar",
    "section": "Árleg útgjöld frá ríkinu",
    "text": "Árleg útgjöld frá ríkinu\nÞað er skemmtilegt að sjá að tveir styrktaraðilar Pyngjunnar, Domino’s og Jómfrúin, eru vinsælustu veitingastaðirnir hjá ríkinu. Eins og vitur maður mælti við mig:\n\nÞetta er hringrás. Þegar öllu er á botninn hvolft erum við sponsaðir af ríkinu.\nArnar Þór Ólafsson"
  },
  {
    "objectID": "pyngjan/opinberar_veitingar/index.html#heildarútgjöld-eftir-stofnun",
    "href": "pyngjan/opinberar_veitingar/index.html#heildarútgjöld-eftir-stofnun",
    "title": "Opinberar veitingar",
    "section": "Heildarútgjöld eftir stofnun",
    "text": "Heildarútgjöld eftir stofnun\nEf við skoðum svo útgjöld hverrar ríkisstofnanar fyrir sig sjáum við mikinn smekksmun innámilli. Til dæmis vinnur greinilega einungis hugsjónafólk með gourmet smekk hjá Lögreglustjóranum á Suðurnesjum því sú stofnun kaupir bara KFC!\nBarnaverndarstofa gengur sömuleiðis ótroðnar slóðir og borðar fjölbreytta blöndu af Mandi og Subway með smá Domino’s inná milli.\n\n\n\n\n\n\nFrumkvöðlaráðgjöf Pyngjunnar og Metils\n\n\n\n\n\nEf þú ert frumkvöðull að hugsa um að opna hamborgarastað og þig vantar stóran reglulegan kúnna væri best að hafa samband við Umhverfisstofnun, Mennta- og menningamálaráðuneytið og Ríkisskattstjóra, og reyna að stela smá bissness frá Tomma. Ef þú kannt að djúpsteikta kjúkling fyrir burgerinn er Lögreglustjórinn á Suðurnesjum þinn mikilvægasti kúnni."
  },
  {
    "objectID": "pyngjan/fyrstukaupendur/index.html",
    "href": "pyngjan/fyrstukaupendur/index.html",
    "title": "Fyrstu kaupendur",
    "section": "",
    "text": "Nýlega var umsjón fasteignaskrár flutt frá Þjóðskrá til Húsnæðis- og mannvirkjastofnunar (HMS). Núna er því hægt að nálgast öll gögn sem tengjast henni á fasteignaskra.is. Hér ætlum við að skoða gögnin um fyrstu kaupendur. Með því að skoða “page source” getum við púslað saman hlekki á JSON skrárnar á bak við myndirnar á síðunni.\nFyrst sjáum við að fleiri kaupendur eru fyrstu kaupendur en áður og að þau eignast sína fyrstu fasteign fyrr, en það varð smá stöðnun í þessari þróun síðasta árið.\n\nNæst sjáum við að fyrsta fasteign fólks er aðeins minni en hún var fyrir 15 árum. Á móti kemur að kaupverðið (leiðrétt fyrir vísitölu fasteignaverðs) hefur lækkað, og fermetraverðið (leiðrétt fyrir vísitölu fasteignaverðs) því haldist nokkuð stöðugt.\n\nEn leiðrétting fyrir vísitölu fasteignaverðs sýnir okkur ekki endilega hvernig ungt fólk er stætt þegar kemur að því að kaupa fasteign. Til þess viljum við frekar sækja gögn Hagstofu um tekjur eftir kyni og aldri. Hér notum við miðgildi ráðstöfunartekna 25 - 29 ára einstaklinga og skoðum meðalkaupverð fyrstu fasteigna sem hlutfall af ráðstöfunartekjunum. Þá sjáum við að þótt fyrsta fasteignin kostar minna en áður miðað við aðrar fasteignir (lækkun þegar leiðrétt fyrir vísitölu fasteignaverðs), þá kostar hún fleiri ár af tekjum. Nánar tiltekið hefur meðalverðið, talið sem ár af ráðstöfunartekjum, farið úr rétt rúmlega 8 í um það bil 11 ár."
  },
  {
    "objectID": "pyngjan/straeto/index.html",
    "href": "pyngjan/straeto/index.html",
    "title": "Strætó",
    "section": "",
    "text": "Í ársreikningi Strætó bs. frá 2021 má finna þessar tvær myndir:\nÞetta er áhugaverð leið til að birta tímaröð af tölum. Vanalega viljum við að tíminn á x-ás byrji vinstra megin og fari svo hækkandi til hægri. Ég myndi t.d. vanalega teikna þessar myndir svona:\nÞað er hins vegar frekar leitt við mína framsetningu að það sést of vel hvað reksturinn gengur illa. Hin framsetningin er því bara frekar góð.\nGetum við notað það sem við höfum lært frá ársreikningi Strætó bs. til að teikna betri mynd af verði staks fargjalds? Skoðum mismunandi framsetningar á gögnunum."
  },
  {
    "objectID": "pyngjan/straeto/index.html#framsetningar",
    "href": "pyngjan/straeto/index.html#framsetningar",
    "title": "Strætó",
    "section": "Framsetningar",
    "text": "Framsetningar\n\nRéttX-ás öfugurY-ás öfugurFyrir hugsjónafólk?\n\n\nHér er venjuleg framsetning sem endurspeglar gögnin. Við erum hinsvegar hugsjónafólk og viljum ekki að fólk hætti að kaupa strætómiða. Hvernig getum við hjálpað fólki að misskilja gögnin svo það haldi áfram að kaupa miða?\n\nVerð strætófargjalds á föstu verðlagi  og  verðlagi hvers árs\n\n\n\n\n\n\n\n\n\n\n\n\nByrjum á því að snúa x-ásinum við. Nú heldur fólk við fýrstu sýn að miðaverðinu fari lækkandi, en ef einhver skoðar myndina nánar sést að x-ásinn er öfugur. Það er því ekki hægt að saka okkur um að ljúga, við erum jú að sýna gögnin!\n\nVerð strætófargjalds á föstu verðlagi  og  verðlagi hvers árs\n\n\n\n\n\n\n\n\n\nKannski höfum við beitt x-ás brögðunum nokkrum sinnum og fólk því á varðbergi. Ekkert mál! Við bara snúum y-ásinum við. Þá virðist miðaverðið ennþá vera að lækka.\n\nVerð strætófargjalds á föstu verðlagi  og  verðlagi hvers árs\n\n\n\n\n\n\n\n\n\nEn hvað ef fólk væri svo mikið á varðbergi að það fylgdist með báðum ásunum til að taka eftir snúningum? Síðasta bragðið sem við getum beitt er þá að snúa báðum ásunum við. Þá virðist reyndar verðið ekki vera að lækka, en ef við treystum á það að fólk sjái að ásarnir séu öfugir er eina vonin okkar að rugla það svo mikið að það viti ekki hvort verðið hafi hækkað eða lækkað og haldi því áfram að kaupa!\n\nVerð strætófargjalds á föstu verðlagi  og  verðlagi hvers árs"
  },
  {
    "objectID": "pyngjan/fasteignafjoldi/index.html",
    "href": "pyngjan/fasteignafjoldi/index.html",
    "title": "Fasteignauppbygging",
    "section": "",
    "text": "Þjóðskrá heldur úti gögnum um fjölda íbúða eftir byggingarári, sem ná alveg aftur til ársins 1900. Skoðum þessi gögn og berum þau saman við gögn Hagstofunnar um mannfjölda eftir kyni og aldri. Við ætlum reyndar ekki að skoða þetta eftir kyni, en það er lítið mál að súmmera upp þessar tölur.\n\n\n\nVið sjáum að neðan að hreinn fjöldi nýrra fasteigna hækkaði stöðugt frá 1900 þangað til hann náði hámarki rétt fyrir 1980. Árlegur fjöldi var svo aðeins lægri þangað til að öðru hámarki var náð rétt fyrir fjármálahrunið.\nEn fólki er alltaf að fjölga svo það er ekki nóg að horfa bara á hreinan fjölda, við viljum skoða fjöldann á þúsund íbúa. Á þeim skala sjáum við að þótt það voru byggðar fleiri fasteignir alls eftir 2000 heldur en kringum 1970 þá voru íslendingar mun fleiri og fasteignafjöldinn á þúsund íbúa því minni.\n\n\n\n\nEn það er heldur ekki nóg að skoða fjöldann út frá íbúum alls. Það eru fá börn og unglingar sem þurfa að eiga fasteign og því er betra að horfa á fjölda nýrra fasteigna á hverja þúsund fullorðna íbúa (20 ára og eldri). Á þeim skala verður munurinn á uppbyggingunni kringum 1970 og 2006 ennþá meiri, enda sjáum við hér að neðan að fullorðnum hefur fjölgað hraðar en börnum síðustu 60 árin.\n\n\n\n\nHvenær hefði hentað Arnari að vera að leita sér að íbúð? Ef við skoðum fjölda nýbyggðra fasteigna per 1.000 íbúa jafngamlir og Arnar er í dag sjáum við að árið 2021 voru byggðar 940 íbúðir á hverja 1.000 jafnaldra, það er næstum ein á mann! En sú tala náði hápunkti árið 1973 þegar það voru byggðar 2139 íbúðir á hverja 1.000, það eru rúmlega tvær á mann! Það er því augljóst að Arnar hefði viljað vera ungur maður árið 1973 til að geta staðið í almennilegu fasteignabraski."
  },
  {
    "objectID": "pyngjan/haskolar/index.html",
    "href": "pyngjan/haskolar/index.html",
    "title": "Háskóli Íslands: Hornkerling?",
    "section": "",
    "text": "Ingvi og Arnar sendu mér eftirfarandi mynd, sem birtist í Stúdentablaðinu árið 2000.\n\n\n\n\n\nÞetta er áhugaverð spurning. Til að svara henni skulum við sækja ríkisútgjöld frá rikisreikningur.is og tengja þau gögn við gögn Hagstofunnar um Nemendur ofan grunnskóla eftir skólum, lögheimili, kennsluformi og kyni 1997-2020. Svo skulum við athuga eftirfarandi:\n\nHver hafa árleg útgjöld ríkisins til háskólanna á Íslandi verið?\nHver var fjöldi nemenda í skólunum á sömu árum?\nHvernig hafa útgjöld á hvern nemanda þróast?\n\nSem bónus skulum við skoða stærðarhagkvæmni háskólanna:\n\nMunu útgjöld á hvern nemanda minnka þegar nemendum fjölgar?\n\n\nÚtgjöld\nAð neðan sjáum við þróun útgjöldanna á verðlagi hvers árs og á föstu verðlagi 2022 (leiðrétt fyrir hækkun vísitölu neysluverðs). Myndirnar eru sýndar á lograkvarða, sem þýðir að fjarlægðin milli 1, 10 og 100 er jafnmikil. Annað sem á við um lograkvarða er að ef mismunurinn á línum er alltaf sá sami er hlutfallslegur munur á útgjöldunum alltaf sá sami.\n\nVerðlag hvers ársFast verðlag\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nNemendur\nVið sjáum svo nemendafjöldann hér að neðan. Þar sem það er svona mikill munur á stærð skólanna þurfum við að teikna þessar myndir á lograkvarða líka, annars myndu minni skólarnir allir þjappast saman við botninn á myndunum.\nDreifing nemenda á stærri skólana hefur haldist frekar stöðug með uþb 70% í Háskóla Íslands, 8-10% í Háskólann á Akureyri og 15-20% í Háskólann í Reykjavík. Hinir skólanir eru svo með 1-5% af nemendum hver.\n\nFjöldiDreifing\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nÚtgjöld á nemanda\nHér byrjum við svo að baka köku úr gögnunum. Með því að tengja saman þessi tvö gagnasöfn getum við þæginlega teiknað upp þróun ríkisútgjalda á hvern nemanda í öllum Íslensku háskólunum.\nÍ upphafi tímabilsins eru útgjöldin per nemandi langhæst hjá Háskólanum á Hólum og Landbúnaðarháskóla Íslands. Þar hefur þó farið fram mikil hagræðing síðan þá og eru þessir skólar komnir með útgjöld á nemanda í kringum Listaháskóla Íslands. Fyrir utan þessa þrjá skóla er svo langt stökk niður til Háskólans á Akureyri, Háskóla Íslands og Háskólans í Reykjavík.\nEf við lítum á Staðan 2020 sjáum við útgjöld á hvern nemanda árið 2020, en sett fram á verðlagi 2000 samkvæmt vísitölu neysluverðs. Þar sjáum við að útgjöldin til HÍ og HR eru nánast nákvæmlega þau sömu og árið 2000, en framlög til HA hafa lækkað töluvert miðað við myndina í Stúdentablaðinu að ofan.\n\nVerðlag hvers ársFast verðlagStaðan 2020\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nBónus: Stærðarhagkvæmni\nHér að neðan sjáum við að það er einhver stærðarhagkvæmni í mörgum háskólunum, þ.e. útgjöld á hvern nemanda minnka þegar heildarfjöldi nemenda hækkar. Það er reyndar gott að hafa í huga að gæði náms og rannsókna, og kostnaður við rekstur þess vegna, eru ekki fönguð í þessari mynd heldur bara útgjöldin frá ríkissjóði."
  },
  {
    "objectID": "maelabord.html",
    "href": "maelabord.html",
    "title": "Metill",
    "section": "",
    "text": "Fjármál sveitarfélaga \n                 Gagnvirk samantekt á ársreikningum sveitarfélaga úr gögnum Sambands Íslenskra Sveitarfélaga \n              \n            \n              \n                \n                  \n                \n                \n                   Eignir, skuldir og skattar \n                   Gagnvirkt tól til að skoða eignir, tekjur og skuldir Íslendinga í skattframtalsgögnum Hagstofunnar \n                \n              \n              \n                \n                  \n                \n                \n                   Verðbólga (í vinnslu) \n                   Reiknaðu þína persónulega verðbólgu með þessari gagnvirku framsetningu á vísitölu neysluverðs \n                \n              \n      \n    \n          \n            \n            Previous\n          \n          \n            \n            Next"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Metill",
    "section": "",
    "text": "Loftgæði \n             Samantekt á mælingum köfnunarefnisdíoxíðs (NO2) við Grensásveg \n          \n        \n        \n          \n            \n          \n          \n             Nýlega var fjallað um óvenjulega háar mælingar á NO2 í Reykjavíkurborg. Hversu algeng eru slík tilvik? Hér ber ég mælingar ársins 2023 saman við fyrri ár.\n \n          \n        \n      \n      \n  \n  \n      \n        \n          \n          \n             Vinnumarkaður \n             Jan 17, 2023 \n             Hver er fjöldi starfandi einstaklinga og hvernig skiptast þeir á vinnumarkaði? \n            \n          \n          \n      \n      \n        \n          \n          \n             Vísitala neysluverðs \n             Dec 22, 2022 \n             Vísitalan og áhrif undirtalna á heildina unnið úr nýjustu gögnum Hagstofu hverju sinni \n            \n          \n          \n      \n      \n        \n          \n          \n             Fjármál stjórnmálaflokkanna \n             Oct 17, 2022 \n             Greining á ársreikningum stjórnmálaflokka úr gögnum Ríkisendurskoðunar \n            \n          \n          \n      \n      \n        \n          \n          \n             Leikskólar \n             Oct 5, 2022 \n             Hvernig gengur sveitarfélögum landsins að brúa bilið? \n            \n          \n          \n      \n  \n\n\nNo matching items\n\n\nMælaborð\n\n\n  \n    \n        \n          \n          \n          \n        \n        \n            \n              \n                \n              \n              \n                 Fjármál sveitarfélaga \n                 Gagnvirk samantekt á ársreikningum sveitarfélaga úr gögnum Sambands Íslenskra Sveitarfélaga \n              \n            \n              \n                \n                  \n                \n                \n                   Eignir, skuldir og skattar \n                   Gagnvirkt tól til að skoða eignir, tekjur og skuldir Íslendinga í skattframtalsgögnum Hagstofunnar \n                \n              \n              \n                \n                  \n                \n                \n                   Verðbólga (í vinnslu) \n                   Reiknaðu þína persónulega verðbólgu með þessari gagnvirku framsetningu á vísitölu neysluverðs \n                \n              \n      \n    \n          \n            \n            Previous\n          \n          \n            \n            Next"
  },
  {
    "objectID": "greinar/stjornmalaflokkar/index.html",
    "href": "greinar/stjornmalaflokkar/index.html",
    "title": "Fjármál stjórnmálaflokkanna",
    "section": "",
    "text": "Code\nif (!file.exists(\"data/data.csv\")) {\n  \n  init_db()\n  \n  d <- mtl_arsreikningar_stjornmalaflokka() |> \n    collect() |> \n    mutate_all(~ ifelse(is.na(.), 0, .)) |> \n    inner_join(\n      vnv() |> \n        group_by(ar = year(date)) |> \n        summarise(cpi = mean(cpi)) |> \n        mutate(cpi = cpi / cpi[ar == max(ar)]),\n      by = \"ar\"\n    ) |> \n    mutate(\n      flokkur = case_when(\n        flokkur == \"Flokkur Fólksins\" ~ \"Flokkur fólksins\",\n        flokkur == \"Framsóknarflokkurinn\" ~ \"Framsóknarflokkur\",\n        TRUE ~ flokkur\n      )\n    )\n  \n  d <- d |> \n    inner_join(\n      flokkar_palette(),\n      by = \"flokkur\"\n    ) |> \n    left_join(\n      mtl_atkvaedi_stjornmalaflokka() |> \n        filter(ar >= 2007) |> \n        collect() |> \n        mutate(ar = ifelse(ar == 2021, 2020, ar)),\n      by = c(\"flokkur\", \"ar\")\n    ) |> \n    left_join(\n      mtl_thingmenn_stjornmalaflokka() |> \n        filter(ar >= 2007) |> \n        collect() |> \n        mutate(ar = ifelse(ar == 2021, 2020, ar)),\n      by = c(\"flokkur\", \"ar\")\n    )\n  \n  d |> \n    write_csv(\"data/data.csv\")\n  \n} else {\n  d <- read_csv(\"data/data.csv\")\n}\n\n\nRows: 95 Columns: 26\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (3): flokkur, merki, litur\ndbl (23): ar, framlog_rikis, framlog_althingi, framlog_svf, framlog_fyrirtae...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n\nCode\nisk <- function(x, scale = 1e6, suffix = \" m.kr\") number(x / scale, suffix = suffix, big.mark = \".\", decimal.mark = \",\")\nhlutf <- label_percent(accuracy = 0.1, big.mark = \".\", decimal.mark = \",\")"
  },
  {
    "objectID": "greinar/stjornmalaflokkar/index.html#opinber-framlög",
    "href": "greinar/stjornmalaflokkar/index.html#opinber-framlög",
    "title": "Fjármál stjórnmálaflokkanna",
    "section": "Opinber framlög",
    "text": "Opinber framlög\n\nStjórnmálasamtök sem hafa fengið a.m.k. einn mann kjörinn á þing eða náð að lágmarki 2,5% atkvæða eiga rétt til framlaga. Það framlag skiptist hlutfallslega milli flokka eftir atkvæðamagni í næstliðnum kosningum. Fjármála- og efnahagsráðuneytið fer með framkvæmd greiðslna á þessu framlagi.\nStjórnarráð Íslands\nSveitarfélag skal veita stjórnmálasamtökum, sem fengið hafa a.m.k. einn mann kjörinn í sveitarstjórn eða hlotið hið minnsta 5% atkvæða í næstliðnum sveitarstjórnarkosningum, árleg fjárframlög til starfsemi sinnar. Gilda hér um ákvæði 2. mgr. 5.gr. laga nr. 162/2006. Skal framlögum úthlutað í hlutfalli við atkvæðamagn. Miða skal við að greiða 175 kr. á hvern íbúa sem lögheimili á í sveitarfélaginu 1. janúar á ári hverju. Þessi fjárhæð tekur breytingum árlega miðað við vísitölu neysluverðs í október ár hvert og er grunnvísitalan 472,2 stig, m.v. október 2019.\nSamband íslenskra sveitarfélaga\n\n\nMagnDreifing\n\n\n\nFramlög hins opinbera til stjórnmálaflokka lækkuðu stöðugt frá 2007 til 2017 en hækkuðu svo aftur árið 2018.\n\n\n\nCode\nd |> \n  mutate(value = framlog_althingi + framlog_rikis + framlog_svf,\n         value = value / cpi) |> \n  magn_plot(title = \"Framlög hins opinbera\")\n\n\nWarning: 'layout' objects don't have these attributes: 'tooltip'\nValid attributes include:\n'_deprecated', 'activeshape', 'annotations', 'autosize', 'autotypenumbers', 'calendar', 'clickmode', 'coloraxis', 'colorscale', 'colorway', 'computed', 'datarevision', 'dragmode', 'editrevision', 'editType', 'font', 'geo', 'grid', 'height', 'hidesources', 'hoverdistance', 'hoverlabel', 'hovermode', 'images', 'legend', 'mapbox', 'margin', 'meta', 'metasrc', 'modebar', 'newshape', 'paper_bgcolor', 'plot_bgcolor', 'polar', 'scene', 'selectdirection', 'selectionrevision', 'separators', 'shapes', 'showlegend', 'sliders', 'smith', 'spikedistance', 'template', 'ternary', 'title', 'transition', 'uirevision', 'uniformtext', 'updatemenus', 'width', 'xaxis', 'yaxis', 'barmode', 'bargap', 'mapType'\n\n\nWarning: 'config' objects don't have these attributes: 'tooltip'\nValid attributes include:\n'autosizable', 'displaylogo', 'displayModeBar', 'doubleClick', 'doubleClickDelay', 'editable', 'edits', 'fillFrame', 'frameMargins', 'globalTransforms', 'linkText', 'locale', 'locales', 'logging', 'mapboxAccessToken', 'modeBarButtons', 'modeBarButtonsToAdd', 'modeBarButtonsToRemove', 'notifyOnLogging', 'plotGlPixelRatio', 'plotlyServerURL', 'queueLength', 'responsive', 'scrollZoom', 'sendData', 'setBackground', 'showAxisDragHandles', 'showAxisRangeEntryBoxes', 'showEditInChartStudio', 'showLink', 'showSendToCloud', 'showSources', 'showTips', 'staticPlot', 'toImageButtonOptions', 'topojsonURL', 'typesetMath', 'watermark'\n\n\n\n\n\n\n\n\n\n\nCode\nd |> \n  mutate(value = framlog_althingi + framlog_rikis + framlog_svf,\n         value = value / cpi) |> \n  dreifing_plot(title = \"Dreifing framlaga hins opinbera\")"
  },
  {
    "objectID": "greinar/stjornmalaflokkar/index.html#fyrirtækilögaðilar-og-einstaklingar",
    "href": "greinar/stjornmalaflokkar/index.html#fyrirtækilögaðilar-og-einstaklingar",
    "title": "Fjármál stjórnmálaflokkanna",
    "section": "Fyrirtæki/lögaðilar og einstaklingar",
    "text": "Fyrirtæki/lögaðilar og einstaklingar\n\nVenjulegir aðilar (fólk og fyrirtæki) mega styrkja hvern flokk um 550.000 krónur ár hvert, heimildin var hækkuð úr 400.000 með lagabreytingu árið 2018.\nBaldur S. Blöndal, Vísindavefurinn\n\n\nMagnDreifing\n\n\nMeð því að færa músina yfir y-ás er hægt að þysja inn og sjá betur þróun áranna eftir 2007.\n\n\nCode\nbreaks <- seq(2008, 2020, by = 2)\nlabels <- breaks\n\nd |> \n  mutate(value = framlog_fyrirtaekja,\n         value = value / cpi) |> \n  magn_plot(title = \"Framlög fyrirtækja\",\n            breaks =  seq(2008, 2020, by = 2),\n            labels =  seq(2008, 2020, by = 2))\n\n\nWarning: 'layout' objects don't have these attributes: 'tooltip'\nValid attributes include:\n'_deprecated', 'activeshape', 'annotations', 'autosize', 'autotypenumbers', 'calendar', 'clickmode', 'coloraxis', 'colorscale', 'colorway', 'computed', 'datarevision', 'dragmode', 'editrevision', 'editType', 'font', 'geo', 'grid', 'height', 'hidesources', 'hoverdistance', 'hoverlabel', 'hovermode', 'images', 'legend', 'mapbox', 'margin', 'meta', 'metasrc', 'modebar', 'newshape', 'paper_bgcolor', 'plot_bgcolor', 'polar', 'scene', 'selectdirection', 'selectionrevision', 'separators', 'shapes', 'showlegend', 'sliders', 'smith', 'spikedistance', 'template', 'ternary', 'title', 'transition', 'uirevision', 'uniformtext', 'updatemenus', 'width', 'xaxis', 'yaxis', 'barmode', 'bargap', 'mapType'\n\n\nWarning: 'config' objects don't have these attributes: 'tooltip'\nValid attributes include:\n'autosizable', 'displaylogo', 'displayModeBar', 'doubleClick', 'doubleClickDelay', 'editable', 'edits', 'fillFrame', 'frameMargins', 'globalTransforms', 'linkText', 'locale', 'locales', 'logging', 'mapboxAccessToken', 'modeBarButtons', 'modeBarButtonsToAdd', 'modeBarButtonsToRemove', 'notifyOnLogging', 'plotGlPixelRatio', 'plotlyServerURL', 'queueLength', 'responsive', 'scrollZoom', 'sendData', 'setBackground', 'showAxisDragHandles', 'showAxisRangeEntryBoxes', 'showEditInChartStudio', 'showLink', 'showSendToCloud', 'showSources', 'showTips', 'staticPlot', 'toImageButtonOptions', 'topojsonURL', 'typesetMath', 'watermark'\n\n\nCode\nd |> \n  mutate(value = framlog_einstaklinga,\n         value = value / cpi) |> \n  magn_plot(title = \"Framlög einstaklinga\",\n            breaks =  seq(2008, 2020, by = 2),\n            labels =  seq(2008, 2020, by = 2))\n\n\nWarning: 'layout' objects don't have these attributes: 'tooltip'\nValid attributes include:\n'_deprecated', 'activeshape', 'annotations', 'autosize', 'autotypenumbers', 'calendar', 'clickmode', 'coloraxis', 'colorscale', 'colorway', 'computed', 'datarevision', 'dragmode', 'editrevision', 'editType', 'font', 'geo', 'grid', 'height', 'hidesources', 'hoverdistance', 'hoverlabel', 'hovermode', 'images', 'legend', 'mapbox', 'margin', 'meta', 'metasrc', 'modebar', 'newshape', 'paper_bgcolor', 'plot_bgcolor', 'polar', 'scene', 'selectdirection', 'selectionrevision', 'separators', 'shapes', 'showlegend', 'sliders', 'smith', 'spikedistance', 'template', 'ternary', 'title', 'transition', 'uirevision', 'uniformtext', 'updatemenus', 'width', 'xaxis', 'yaxis', 'barmode', 'bargap', 'mapType'\n\nWarning: 'config' objects don't have these attributes: 'tooltip'\nValid attributes include:\n'autosizable', 'displaylogo', 'displayModeBar', 'doubleClick', 'doubleClickDelay', 'editable', 'edits', 'fillFrame', 'frameMargins', 'globalTransforms', 'linkText', 'locale', 'locales', 'logging', 'mapboxAccessToken', 'modeBarButtons', 'modeBarButtonsToAdd', 'modeBarButtonsToRemove', 'notifyOnLogging', 'plotGlPixelRatio', 'plotlyServerURL', 'queueLength', 'responsive', 'scrollZoom', 'sendData', 'setBackground', 'showAxisDragHandles', 'showAxisRangeEntryBoxes', 'showEditInChartStudio', 'showLink', 'showSendToCloud', 'showSources', 'showTips', 'staticPlot', 'toImageButtonOptions', 'topojsonURL', 'typesetMath', 'watermark'\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCode\nd |> \n  mutate(value = framlog_fyrirtaekja,\n         value = value / cpi) |> \n  dreifing_plot(title = \"Dreifing framlaga fyrirtækja/lögaðila\",\n                breaks =  seq(2008, 2020, by = 2),\n                labels =  seq(2008, 2020, by = 2))\nd |> \n  mutate(value = framlog_einstaklinga,\n         value = value / cpi) |> \n  dreifing_plot(title = \"Dreifing framlaga einstaklinga\",\n                breaks =  seq(2008, 2020, by = 2),\n                labels =  seq(2008, 2020, by = 2))"
  },
  {
    "objectID": "greinar/stjornmalaflokkar/index.html#aðrar-tekjur",
    "href": "greinar/stjornmalaflokkar/index.html#aðrar-tekjur",
    "title": "Fjármál stjórnmálaflokkanna",
    "section": "Aðrar tekjur",
    "text": "Aðrar tekjur\nAðrar tekjur eru meðal annars útleiga á fasteignum (t.d. veislusölum), miðasala á viðburði, sala á auglýsingaplássi, eða önnur útseld þjónusta. Örfáir flokkar hafa slíkar tekjur, en Sjálfstæðisflokkur fær langmestar slíkar tekjur. Við munum líka sjá neðar að flokkurinn á meirihluta allra eigna flokkanna, þar á meðal fasteignir.\n\n\nCode\nd |> \n  mutate(value = adrar_tekjur,\n         value = value / cpi) |> \n  dreifing_plot(title = \"Dreifing annarra tekna\",\n                breaks = seq(2008, 2020, by = 2),\n                labels = seq(2008, 2020, by = 2))\nd |> \n  mutate(value = adrar_tekjur,\n         value = value / cpi) |> \n  magn_plot(title = \"Aðrar tekjur\",\n            breaks = seq(2008, 2020, by = 2),\n            labels = seq(2008, 2020, by = 2))\n\n\nWarning: 'layout' objects don't have these attributes: 'tooltip'\nValid attributes include:\n'_deprecated', 'activeshape', 'annotations', 'autosize', 'autotypenumbers', 'calendar', 'clickmode', 'coloraxis', 'colorscale', 'colorway', 'computed', 'datarevision', 'dragmode', 'editrevision', 'editType', 'font', 'geo', 'grid', 'height', 'hidesources', 'hoverdistance', 'hoverlabel', 'hovermode', 'images', 'legend', 'mapbox', 'margin', 'meta', 'metasrc', 'modebar', 'newshape', 'paper_bgcolor', 'plot_bgcolor', 'polar', 'scene', 'selectdirection', 'selectionrevision', 'separators', 'shapes', 'showlegend', 'sliders', 'smith', 'spikedistance', 'template', 'ternary', 'title', 'transition', 'uirevision', 'uniformtext', 'updatemenus', 'width', 'xaxis', 'yaxis', 'barmode', 'bargap', 'mapType'\n\n\nWarning: 'config' objects don't have these attributes: 'tooltip'\nValid attributes include:\n'autosizable', 'displaylogo', 'displayModeBar', 'doubleClick', 'doubleClickDelay', 'editable', 'edits', 'fillFrame', 'frameMargins', 'globalTransforms', 'linkText', 'locale', 'locales', 'logging', 'mapboxAccessToken', 'modeBarButtons', 'modeBarButtonsToAdd', 'modeBarButtonsToRemove', 'notifyOnLogging', 'plotGlPixelRatio', 'plotlyServerURL', 'queueLength', 'responsive', 'scrollZoom', 'sendData', 'setBackground', 'showAxisDragHandles', 'showAxisRangeEntryBoxes', 'showEditInChartStudio', 'showLink', 'showSendToCloud', 'showSources', 'showTips', 'staticPlot', 'toImageButtonOptions', 'topojsonURL', 'typesetMath', 'watermark'\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nÞað er áhugavert að sjá að tekjur Sjálfstæðisflokks af útleigu eru svo miklar að þær myndu nægja til að fjármagna allt starf Flokks fólksins. Ef við tökum með miðasölu á viðburði, auglýsingapláss og selda þjónustu gætu aðrar tekjur Sjálfstæðisflokks fjármagnað flokk Pírata.\n\n\n\n\n\nCode\nplot_dat <- d |> \n  mutate(\n    value = ifelse(\n      flokkur == \"Sjálfstæðisflokkur\", \n      leigutekjur,\n      gjold\n    ),\n    value = value / cpi\n  ) |> \n  filter(\n    flokkur %in% c(\"Sjálfstæðisflokkur\", \"Flokkur fólksins\", \"Viðreisn\"),\n    ar >= 2015\n  ) |> \n  mutate(y = value,\n         # y = case_when(\n         #     flokkur == \"Flokkur Fólksins\" ~ y * 1.006,\n         #     flokkur == \"Viðreisn\" ~ y * 0.992,\n         #     flokkur == \"Sjálfstæðisflokkur\" ~ y * 0.994,\n         #     TRUE ~ y\n         # ),\n         label = ifelse(\n           flokkur == \"Sjálfstæðisflokkur\",\n           \"Sjálfstæðisflokkur<br>(Leigutekjur)\",\n           str_c(flokkur, \"<br>(Útgjöld)\")\n         )\n  )\n\np <- plot_dat |> \n  ggplot(aes(ar, value, colour = flokkur)) +\n  geom_line(size = 1,) +\n  geom_richtext(\n    data = plot_dat |> \n      filter(ar == max(ar)) |> \n      mutate(\n        x = case_when(\n          flokkur == \"Viðreisn\" ~ ar + 0.3,\n          TRUE ~ ar + 0.5\n        )\n      ),\n    aes(x = x, label = label, y = y),\n    hjust = 0.5,\n    size = 4.5,\n    fill = NA, label.color = NA\n  ) +\n  scale_x_continuous(limits = c(2014.8, 2021.2),\n                     expand = expansion(),\n                     breaks = c(2015:2020)) +\n  scale_y_continuous(labels = isk,\n                     breaks = pretty_breaks(4),\n                     limits = c(0, 82e6),\n                     expand = expansion()) +\n  scale_colour_manual(\n    values = flokkar_palette() |> slice(8, 1, 5) |> pull(litur)\n  ) +\n  theme(legend.position = \"none\") +\n  labs(x = NULL,\n       y = NULL,\n       title = \"Leigutekjur Sjálfstæðisflokks og útgjöld minni flokka\",\n       subtitle = \"Sjálfstæðisflokkur fengi nægar tekjur af útleigu fasteigna til að fjármagna Flokk floksins\",\n       caption = \"Metill.is\")\n\n\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n\n\nCode\nggsave(\n  plot = p +\n    theme(\n      plot.background = element_rect(fill = \"#f0efef\"),\n      panel.background = element_rect(fill = \"#f0efef\"),\n      panel.grid = element_blank()\n    ), \n  filename = \"Figures/samanburdur_page.png\",\n  width = 8, \n  height = 0.56 * 8, \n  scale = 1.1, \n  dpi = 300\n)\n\nggsave(\n  plot = p, \n  filename = \"Figures/samanburdur.png\",\n  width = 8, \n  height = 0.5 * 8, \n  scale = 1.3, \n  dpi = 300\n)\n\n\n\n\n\n\nCode\nplot_dat <- d |> \n  mutate(\n    value = ifelse(\n      flokkur == \"Sjálfstæðisflokkur\", \n      adrar_tekjur,\n      gjold\n    ),\n    value = value / cpi\n  ) |> \n  filter(\n    flokkur %in% c(\"Sjálfstæðisflokkur\", \"Flokkur fólksins\", \"Viðreisn\", \"Píratar\"),\n    ar >= 2015\n  ) |> \n  mutate(y = value,\n         y = case_when(\n           flokkur == \"Sjálfstæðisflokkur\" ~ y * 0.93,\n           flokkur == \"Píratar\" ~ y * 1.01,\n           flokkur == \"Viðreisn\" ~ y * 1.01,\n           flokkur == \"Flokkur fólksins\" ~ y * 1.07,\n           TRUE ~ y\n         ),\n         label = ifelse(\n           flokkur == \"Sjálfstæðisflokkur\",\n           \"Sjálfstæðisflokkur<br>(Aðrar tekjur)\",\n           str_c(flokkur, \" (Útgjöld)\")\n         )\n  )\n\np <- plot_dat |> \n  ggplot(aes(ar, value, colour = flokkur)) +\n  geom_line(size = 1,) +\n  geom_richtext(\n    data = plot_dat |> \n      filter(ar == max(ar)) |> \n      mutate(\n        x = case_when(\n          flokkur == \"Viðreisn\" ~ ar + 0.6,\n          flokkur == \"Píratar\" ~ ar + 0.6,\n          flokkur == \"Flokkur fólksins\" ~ ar + 0.5,\n          TRUE ~ ar + 0.7\n        )\n      ),\n    aes(x = x, label = label, y = y),\n    hjust = 0.5,\n    size = 4.5,\n    fill = NA, label.color = NA\n  ) +\n  scale_x_continuous(limits = c(2014.8, 2021.3),\n                     expand = expansion(),\n                     breaks = c(2015:2020)) +\n  scale_y_continuous(labels = isk,\n                     breaks = pretty_breaks(4),\n                     limits = c(0, NA),\n                     expand = expansion()) +\n  scale_colour_manual(\n    values = flokkar_palette() |> slice(8, 6, 1, 5) |> pull(litur)\n  ) +\n  theme(legend.position = \"none\") +\n  labs(x = NULL,\n       y = NULL,\n       title = \"Aðrar tekjur Sjálfstæðisflokks og útgjöld minni flokka\",\n       subtitle = \"Útleiga, miðasala, auglýsingar og seld þjónusta Sjálfstæðisflokks gætu fjármagnað flokk Pírata\",\n       caption = \"Metill.is\")\n\nggsave(\n  plot = p +\n    theme(\n      plot.background = element_rect(fill = \"#f0efef\"),\n      panel.background = element_rect(fill = \"#f0efef\"),\n      panel.grid = element_blank()\n    ), \n  filename = \"Figures/samanburdur2_page.png\",\n  width = 8, \n  height = 0.56 * 8, \n  scale = 1.1, \n  dpi = 300\n)\n\nggsave(\n  plot = p, \n  filename = \"Figures/samanburdur2.png\",\n  width = 8, \n  height = 0.5 * 8, \n  scale = 1.3, \n  dpi = 300\n)"
  },
  {
    "objectID": "greinar/stjornmalaflokkar/index.html#eignir",
    "href": "greinar/stjornmalaflokkar/index.html#eignir",
    "title": "Fjármál stjórnmálaflokkanna",
    "section": "Eignir",
    "text": "Eignir\nEignir geta verið tvenns konar:\n\nVeltufjármunir Þetta er handbært fé eða eignir sem er auðvelt að breyta í peninga. Hjá flestum flokkum eru eignirnar að mestu leyti veltufjármunir, þ.e. uppsafnaðir peningar frá ríkinu og styrktaraðilum.\nFastafjármunir Þetta eru eignir sem er ekki jafn auðvelt að breyta í peninga. Sjálfstæðisflokkur hefur átt kringum 65% allra fastafjármuna flokkanna og eru þeir að mestu leyti fasteignir.\n\n\n\nCode\nd |> \n  mutate(value = eignir,\n         value = value / cpi) |> \n  magn_plot(title = \"Eignir\",\n            breaks = seq(2008, 2020, by = 2),\n            labels = seq(2008, 2020, by = 2))\n\n\nWarning: 'layout' objects don't have these attributes: 'tooltip'\nValid attributes include:\n'_deprecated', 'activeshape', 'annotations', 'autosize', 'autotypenumbers', 'calendar', 'clickmode', 'coloraxis', 'colorscale', 'colorway', 'computed', 'datarevision', 'dragmode', 'editrevision', 'editType', 'font', 'geo', 'grid', 'height', 'hidesources', 'hoverdistance', 'hoverlabel', 'hovermode', 'images', 'legend', 'mapbox', 'margin', 'meta', 'metasrc', 'modebar', 'newshape', 'paper_bgcolor', 'plot_bgcolor', 'polar', 'scene', 'selectdirection', 'selectionrevision', 'separators', 'shapes', 'showlegend', 'sliders', 'smith', 'spikedistance', 'template', 'ternary', 'title', 'transition', 'uirevision', 'uniformtext', 'updatemenus', 'width', 'xaxis', 'yaxis', 'barmode', 'bargap', 'mapType'\n\n\nWarning: 'config' objects don't have these attributes: 'tooltip'\nValid attributes include:\n'autosizable', 'displaylogo', 'displayModeBar', 'doubleClick', 'doubleClickDelay', 'editable', 'edits', 'fillFrame', 'frameMargins', 'globalTransforms', 'linkText', 'locale', 'locales', 'logging', 'mapboxAccessToken', 'modeBarButtons', 'modeBarButtonsToAdd', 'modeBarButtonsToRemove', 'notifyOnLogging', 'plotGlPixelRatio', 'plotlyServerURL', 'queueLength', 'responsive', 'scrollZoom', 'sendData', 'setBackground', 'showAxisDragHandles', 'showAxisRangeEntryBoxes', 'showEditInChartStudio', 'showLink', 'showSendToCloud', 'showSources', 'showTips', 'staticPlot', 'toImageButtonOptions', 'topojsonURL', 'typesetMath', 'watermark'\n\n\n\n\n\n\n\n\n\n\nVið sjáum að margir flokkar hafa talsverða veltufjármuni, en örfáir flokkar hafa einhverja fastafjármuni.\n\n\nCode\nd |> \n  mutate(value = veltufjarmunir,\n         value = value / cpi) |> \n  magn_plot(title = \"Veltufjármunir\",\n            breaks = seq(2008, 2020, by = 2),\n            labels = seq(2008, 2020, by = 2))\n\n\nWarning: 'layout' objects don't have these attributes: 'tooltip'\nValid attributes include:\n'_deprecated', 'activeshape', 'annotations', 'autosize', 'autotypenumbers', 'calendar', 'clickmode', 'coloraxis', 'colorscale', 'colorway', 'computed', 'datarevision', 'dragmode', 'editrevision', 'editType', 'font', 'geo', 'grid', 'height', 'hidesources', 'hoverdistance', 'hoverlabel', 'hovermode', 'images', 'legend', 'mapbox', 'margin', 'meta', 'metasrc', 'modebar', 'newshape', 'paper_bgcolor', 'plot_bgcolor', 'polar', 'scene', 'selectdirection', 'selectionrevision', 'separators', 'shapes', 'showlegend', 'sliders', 'smith', 'spikedistance', 'template', 'ternary', 'title', 'transition', 'uirevision', 'uniformtext', 'updatemenus', 'width', 'xaxis', 'yaxis', 'barmode', 'bargap', 'mapType'\n\n\nWarning: 'config' objects don't have these attributes: 'tooltip'\nValid attributes include:\n'autosizable', 'displaylogo', 'displayModeBar', 'doubleClick', 'doubleClickDelay', 'editable', 'edits', 'fillFrame', 'frameMargins', 'globalTransforms', 'linkText', 'locale', 'locales', 'logging', 'mapboxAccessToken', 'modeBarButtons', 'modeBarButtonsToAdd', 'modeBarButtonsToRemove', 'notifyOnLogging', 'plotGlPixelRatio', 'plotlyServerURL', 'queueLength', 'responsive', 'scrollZoom', 'sendData', 'setBackground', 'showAxisDragHandles', 'showAxisRangeEntryBoxes', 'showEditInChartStudio', 'showLink', 'showSendToCloud', 'showSources', 'showTips', 'staticPlot', 'toImageButtonOptions', 'topojsonURL', 'typesetMath', 'watermark'\n\n\nCode\nd |> \n  mutate(value = eignir - veltufjarmunir,\n         value = value / cpi) |> \n  magn_plot(title = \"Fastafjármunir\",\n            breaks = seq(2008, 2020, by = 2),\n            labels = seq(2008, 2020, by = 2))\n\n\nWarning: 'layout' objects don't have these attributes: 'tooltip'\nValid attributes include:\n'_deprecated', 'activeshape', 'annotations', 'autosize', 'autotypenumbers', 'calendar', 'clickmode', 'coloraxis', 'colorscale', 'colorway', 'computed', 'datarevision', 'dragmode', 'editrevision', 'editType', 'font', 'geo', 'grid', 'height', 'hidesources', 'hoverdistance', 'hoverlabel', 'hovermode', 'images', 'legend', 'mapbox', 'margin', 'meta', 'metasrc', 'modebar', 'newshape', 'paper_bgcolor', 'plot_bgcolor', 'polar', 'scene', 'selectdirection', 'selectionrevision', 'separators', 'shapes', 'showlegend', 'sliders', 'smith', 'spikedistance', 'template', 'ternary', 'title', 'transition', 'uirevision', 'uniformtext', 'updatemenus', 'width', 'xaxis', 'yaxis', 'barmode', 'bargap', 'mapType'\n\nWarning: 'config' objects don't have these attributes: 'tooltip'\nValid attributes include:\n'autosizable', 'displaylogo', 'displayModeBar', 'doubleClick', 'doubleClickDelay', 'editable', 'edits', 'fillFrame', 'frameMargins', 'globalTransforms', 'linkText', 'locale', 'locales', 'logging', 'mapboxAccessToken', 'modeBarButtons', 'modeBarButtonsToAdd', 'modeBarButtonsToRemove', 'notifyOnLogging', 'plotGlPixelRatio', 'plotlyServerURL', 'queueLength', 'responsive', 'scrollZoom', 'sendData', 'setBackground', 'showAxisDragHandles', 'showAxisRangeEntryBoxes', 'showEditInChartStudio', 'showLink', 'showSendToCloud', 'showSources', 'showTips', 'staticPlot', 'toImageButtonOptions', 'topojsonURL', 'typesetMath', 'watermark'\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <- d |> \n  select(ar, flokkur, litur, fasteignir, cpi) |> \n  filter(ar == max(ar)) |> \n  mutate(fasteignir = fasteignir/cpi,\n         flokkur = fct_reorder(flokkur, fasteignir),\n         hlutf = fasteignir / sum(fasteignir))\n\n\np <- plot_dat |> \n  ggplot(aes(fasteignir, flokkur)) +\n  geom_col(aes(fill = litur)) +\n  scale_x_continuous(\n    expand = expansion(),\n    labels = metill::label_isk(scale = 1e-6),\n    breaks = tufte_breaks(plot_dat$fasteignir),\n    sec.axis = sec_axis(\n      trans = ~ . / sum(plot_dat$fasteignir),\n      labels = label_hlutf(),\n      breaks = tufte_breaks(plot_dat$hlutf)\n      )\n    ) +\n  scale_fill_identity() +\n  theme(\n    plot.margin = margin(t = 5, r = 50, b = 5, l = 5)\n  ) +\n  labs(\n    x = NULL,\n    y = NULL,\n    title = \"Fasteignir stjórnmálaflokka í ársreikningum 2020\",\n    subtitle = \"Fjórir flokkar eiga fasteignir fyrir meira en 80 m.kr\",\n    caption = \"Metill.is\"\n  )\n\n\nggsave(\n  plot = p +\n    theme(\n      plot.background = element_rect(fill = \"#f0efef\"),\n      panel.background = element_rect(fill = \"#f0efef\"),\n      panel.grid = element_blank()\n    ), \n  filename = \"Figures/fasteignir_page.png\",\n  width = 8, \n  height = 0.5 * 8, \n  scale = 1.2, \n  dpi = 300\n)\n\nggsave(\n  plot = p, \n  filename = \"Figures/fasteignir.png\",\n  width = 8, \n  height = 0.5 * 8, \n  scale = 1.2, \n  dpi = 300\n)"
  },
  {
    "objectID": "greinar/stjornmalaflokkar/index.html#skuldir",
    "href": "greinar/stjornmalaflokkar/index.html#skuldir",
    "title": "Fjármál stjórnmálaflokkanna",
    "section": "Skuldir",
    "text": "Skuldir\nÞað er ekki nóg að vita bara hverjar eignir flokkanna eru, við viljum líka vita hvort þær séu fjármagnaðar með lántöku eða hreinum eignum.\n\n\nCode\nd |> \n  mutate(value = skuldir,\n         value = value / cpi) |> \n  magn_plot(title = \"Skuldir\")\n\n\nWarning: 'layout' objects don't have these attributes: 'tooltip'\nValid attributes include:\n'_deprecated', 'activeshape', 'annotations', 'autosize', 'autotypenumbers', 'calendar', 'clickmode', 'coloraxis', 'colorscale', 'colorway', 'computed', 'datarevision', 'dragmode', 'editrevision', 'editType', 'font', 'geo', 'grid', 'height', 'hidesources', 'hoverdistance', 'hoverlabel', 'hovermode', 'images', 'legend', 'mapbox', 'margin', 'meta', 'metasrc', 'modebar', 'newshape', 'paper_bgcolor', 'plot_bgcolor', 'polar', 'scene', 'selectdirection', 'selectionrevision', 'separators', 'shapes', 'showlegend', 'sliders', 'smith', 'spikedistance', 'template', 'ternary', 'title', 'transition', 'uirevision', 'uniformtext', 'updatemenus', 'width', 'xaxis', 'yaxis', 'barmode', 'bargap', 'mapType'\n\n\nWarning: 'config' objects don't have these attributes: 'tooltip'\nValid attributes include:\n'autosizable', 'displaylogo', 'displayModeBar', 'doubleClick', 'doubleClickDelay', 'editable', 'edits', 'fillFrame', 'frameMargins', 'globalTransforms', 'linkText', 'locale', 'locales', 'logging', 'mapboxAccessToken', 'modeBarButtons', 'modeBarButtonsToAdd', 'modeBarButtonsToRemove', 'notifyOnLogging', 'plotGlPixelRatio', 'plotlyServerURL', 'queueLength', 'responsive', 'scrollZoom', 'sendData', 'setBackground', 'showAxisDragHandles', 'showAxisRangeEntryBoxes', 'showEditInChartStudio', 'showLink', 'showSendToCloud', 'showSources', 'showTips', 'staticPlot', 'toImageButtonOptions', 'topojsonURL', 'typesetMath', 'watermark'"
  },
  {
    "objectID": "greinar/stjornmalaflokkar/index.html#eigið-fé",
    "href": "greinar/stjornmalaflokkar/index.html#eigið-fé",
    "title": "Fjármál stjórnmálaflokkanna",
    "section": "Eigið fé",
    "text": "Eigið fé\nMeð þekkingu okkar um eignir og skuldir að vopni getum við skoðað eigið fé flokkanna og fengið svör við spurningunni\n\nHverjar eru eignirnar umfram skuldirnar?\n\n\nMagnDreifing\n\n\nVið sjáum til dæmis að Framsóknarflokkur hefur haft neikvætt eigið fé frá 2007 til 2020.\n\n\nCode\nd |>\n  mutate(value = eignir - skuldir,\n         value = value / cpi) |>\n  magn_plot(title = \"Eigið fé íslenskra stjórnmálaflokka\",\n            breaks = seq(2008, 2020, by = 2),\n            labels = seq(2008, 2020, by = 2))\n\n\nWarning: 'layout' objects don't have these attributes: 'tooltip'\nValid attributes include:\n'_deprecated', 'activeshape', 'annotations', 'autosize', 'autotypenumbers', 'calendar', 'clickmode', 'coloraxis', 'colorscale', 'colorway', 'computed', 'datarevision', 'dragmode', 'editrevision', 'editType', 'font', 'geo', 'grid', 'height', 'hidesources', 'hoverdistance', 'hoverlabel', 'hovermode', 'images', 'legend', 'mapbox', 'margin', 'meta', 'metasrc', 'modebar', 'newshape', 'paper_bgcolor', 'plot_bgcolor', 'polar', 'scene', 'selectdirection', 'selectionrevision', 'separators', 'shapes', 'showlegend', 'sliders', 'smith', 'spikedistance', 'template', 'ternary', 'title', 'transition', 'uirevision', 'uniformtext', 'updatemenus', 'width', 'xaxis', 'yaxis', 'barmode', 'bargap', 'mapType'\n\n\nWarning: 'config' objects don't have these attributes: 'tooltip'\nValid attributes include:\n'autosizable', 'displaylogo', 'displayModeBar', 'doubleClick', 'doubleClickDelay', 'editable', 'edits', 'fillFrame', 'frameMargins', 'globalTransforms', 'linkText', 'locale', 'locales', 'logging', 'mapboxAccessToken', 'modeBarButtons', 'modeBarButtonsToAdd', 'modeBarButtonsToRemove', 'notifyOnLogging', 'plotGlPixelRatio', 'plotlyServerURL', 'queueLength', 'responsive', 'scrollZoom', 'sendData', 'setBackground', 'showAxisDragHandles', 'showAxisRangeEntryBoxes', 'showEditInChartStudio', 'showLink', 'showSendToCloud', 'showSources', 'showTips', 'staticPlot', 'toImageButtonOptions', 'topojsonURL', 'typesetMath', 'watermark'\n\n\n\n\n\n\n\n\nAuk þess sjáum við að árið 2007 átti Sjálfstæðisflokkur 100% alls eigin fjár stjórnmálaflokka, en árið 2020 er sú tala dottin niður í 43,5%.\n\n\nCode\nd |>\n  mutate(value = eignir - skuldir,\n         value = value / cpi) |>\n  mutate(value = value * (value >= 0)) |>\n  dreifing_plot(title = \"Dreifing eigin fjár íslenskra stjórnmálaflokka\",\n                breaks = seq(2008, 2020, by = 2),\n                labels = seq(2008, 2020, by = 2)) \n\n\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <- d |> \n  mutate(value = (eignir - skuldir) / cpi) |> \n  select(ar, flokkur, value, litur) |> \n  group_by(ar) |> \n  mutate(p = value / sum(value)) |> \n  ungroup() |> \n  mutate(\n    flokkur = str_to_sentence(flokkur),\n    flokkur = fct_reorder(flokkur, value, .fun = mean)\n  )\n\n\np <- plot_dat |> \n  ggplot(aes(ar, value)) +\n  geom_col(aes(fill = flokkur), position = \"stack\", colour = \"grey95\", width = 1) +\n  scale_x_continuous(breaks = 2007:2020) +\n  scale_y_continuous(labels = isk) +\n  scale_fill_manual(\n    values = c(\n      plot_dat |> arrange(flokkur) |> distinct(litur) |> pull(litur)\n    )\n  ) +\n  coord_cartesian(expand = FALSE) +\n  guides(fill = guide_legend(reverse = T)) +\n  theme(\n    legend.position = \"top\",\n  ) +\n  labs(x = NULL, y = NULL, fill = NULL,\n       title = \"Eigið fé íslenskra stjórnmálaflokka\",\n       subtitle = \"Árið 2007 átti Sjálfstæðisflokkur 100% alls eigin fjár flokkanna en 2020 á hann 43,5%\",\n       caption = \"Mynd frá metill.is unnin úr ársreikningum stjórnmálaflokka frá Ríkisendurskoðun\")\n\nggsave(\n  plot = p,\n  filename = \"Figures/eigidfe.png\",\n  width = 8,\n  height = 0.621 * 8, \n  scale = 1.3\n)\n\nggsave(\n  plot = p +\n    theme(\n      plot.background = element_blank(),\n      panel.background = element_blank(),\n      legend.background = element_blank(),\n      legend.box.background = element_blank()\n    ),\n  filename = \"Figures/eigidfe_page.png\",\n  width = 8,\n  height = 0.621 * 8, \n  scale = 1.3\n)"
  },
  {
    "objectID": "greinar/visitala_neysluverds/index.html",
    "href": "greinar/visitala_neysluverds/index.html",
    "title": "Vísitala neysluverðs",
    "section": "",
    "text": "Hér notum við gögn um Hlutfallslega skiptingu og áhrifaþætti vísitölu neysluverðs frá Hagstofu Íslands."
  },
  {
    "objectID": "greinar/visitala_neysluverds/index.html#reiknuð-húsaleiga",
    "href": "greinar/visitala_neysluverds/index.html#reiknuð-húsaleiga",
    "title": "Vísitala neysluverðs",
    "section": "Reiknuð húsaleiga",
    "text": "Reiknuð húsaleiga\n\nReiknuð húsaleiga er mat á virði þeirrar þjónustu sem eigendur hafa af notkun eigin húsnæðis\nHagstofa Íslands\n\n\n\nCode\nlitur <- colours |> filter(undirvisitala == \"Húsnæði, hiti og rafmagn\") |> pull(colour)\n\np <- d_undir |> \n  filter(flokkur_3 == \"Reiknuð húsaleiga\") |> \n  select(date, breyting, year_breyting) |> \n  rename(\"Mánaðarleg\" = breyting, \"Árleg\" = year_breyting) |> \n  pivot_longer(c(-date)) |> \n  group_by(date) |> \n  mutate(\n    text = str_c(\n      \"Dagsetning: \", format(date, \"%B, %Y\"), \"\\n\",\n      ifelse(name == \"Árleg\", \"<b>\", \"\"),\n      \"Verðbreyting (árleg): \", percent(value[name==\"Árleg\"], accuracy = 0.01, big.mark = \".\", decimal.mark = \",\"), \n      ifelse(name == \"Árleg\", \"</b>\", \"\"),\n      \"\\n\",\n      ifelse(name == \"Mánaðarleg\", \"<b>\", \"\"),\n      \"Verðbreyting (mánaðarleg): \", percent(value[name==\"Mánaðarleg\"], accuracy = 0.01, big.mark = \".\", decimal.mark = \",\"),\n      ifelse(name == \"Mánaðarleg\", \"</b>\", \"\")\n    )\n  ) |> \n  ungroup() |> \n  ggplot(aes(date, value, text = text)) +\n  geom_hline(yintercept = 0, lty = 2, alpha = 0.3) +\n  geom_line(aes(group = name)) +\n  scale_y_continuous(\n    labels = label_percent()\n  ) +\n  facet_wrap(\"name\", scales = \"free_y\", ncol = 1) +\n  labs(\n    x = NULL,\n    y = NULL,\n    title = \"Verðbreytingar á reiknaðri húsaleigu\"\n  )\n\nggplotly(\n  p,\n  tooltip = \"text\"\n) |> \n  layout(hoverlabel = list(align = \"left\")) |> \n  config(displayModeBar = FALSE)"
  },
  {
    "objectID": "greinar/visitala_neysluverds/index.html#þróun-eftir-löndum",
    "href": "greinar/visitala_neysluverds/index.html#þróun-eftir-löndum",
    "title": "Vísitala neysluverðs",
    "section": "Þróun eftir löndum",
    "text": "Þróun eftir löndum\n\n\nCode\nd_sam <- pxweb_get(\n  url = \"https://px.hagstofa.is:443/pxis/api/v1/is/Efnahagur/visitolur/2_samraemdvnv/samraemdvnv/VIS02002.px\", \n  query = list(\n    \"Tegund\" = \"*\",\n    \"Mánuður\" = \"*\",\n    \"Land\" = \"*\"\n  ),\n  verbose = FALSE\n) |> \n  as.data.frame() |> \n  as_tibble() |> \n  janitor::clean_names()|> \n  separate(manudur, into = c(\"ar\", \"man\"), sep = \"M\", convert = T) |> \n  mutate(dags = clock::date_build(ar, man)) |> \n  rename(visitala = verdlag_og_neysla) |> \n  filter(tegund == \"Mánaðarvísitölur\") |> \n  select(dags, land, visitala)\n\n\nWarning in pxweb_as_data_frame.pxweb_data(x, row.names = row.names, optional =\noptional, : NAs introduced by coercion\n\n\n\n\nCode\nlitir <- tribble(\n  ~land, ~litur, ~nudge_y,\n  \"Ísland\", \"#084594\", 0,\n  \"Danmörk\", \"#990000\", 0,\n  \"Noregur\", \"#cb181d\", -0.005,\n  \"Svíþjóð\", \"#fe9929\", 0,\n  \"Finnland\", \"#74a9cf\", 0.005\n)\n\nplot_dat <- d_sam |> \n  group_by(man = month(dags), land) |> \n  mutate(breyting = exp(c(0, diff(log(visitala))))) |> \n  ungroup() |> \n  mutate(\n    text = str_c(\n      \"<b>\", land, \"</b>\", \"\\n\",\n      \"Dagsetning: \", dags, \"\\n\",\n      \"Vísitala (2015 == 100): \", visitala, \"\\n\",\n      \"Árleg breyting: \", hlutf(breyting - 1)\n    )\n  ) |> \n  filter(year(dags) > min(year(dags)),\n         land != \"Tyrkland\") |> \n  left_join(\n    litir,\n    by = \"land\"\n  ) |> \n  mutate(litur = ifelse(is.na(litur), \"#969696\", litur),\n         linewidth = ifelse(litur == \"#969696\", 0, 1),\n         alpha = ifelse(litur == \"#969696\", 0.5, 1))\n\np <- plot_dat |> \n  ggplot(aes(dags, breyting, text = text)) +\n  geom_hline(yintercept = 1, lty = 2, alpha = 0.6) +\n  geom_line(\n    data = plot_dat |> filter(alpha == 0.5),\n    aes(group = land, col = litur, alpha = alpha),\n    linewidth = 0.5\n  ) +\n  geom_line(\n    data = plot_dat |> filter(alpha != 0.5),\n    aes(group = land, col = litur, alpha = alpha),\n    linewidth = 1\n  ) +\n  geom_text(\n    data = plot_dat |> filter(alpha != 0.5, dags == max(dags)),\n    aes(col = litur, label = land, y = breyting + nudge_y),\n    hjust = 1, nudge_x = 100\n  ) +\n  scale_y_continuous(\n    labels = function(x) hlutf(x - 1)\n  ) +\n  scale_colour_identity() +\n  scale_alpha_identity() +\n  coord_cartesian(clip = \"off\") +\n  theme(\n    legend.position = \"none\",\n    plot.margin = margin(t = 5, r = 35, b = 5, l = 5)\n  ) +\n  labs(\n    x = NULL,\n    y = NULL,\n    title = \"Árleg breyting samræmdrar vísitölu neysluverðs eftir landi\"\n  )\n\nmetill_ggplotly(\n  p,\n  tooltip = \"text\"\n)\n\n\nWarning: 'layout' objects don't have these attributes: 'tooltip'\nValid attributes include:\n'_deprecated', 'activeshape', 'annotations', 'autosize', 'autotypenumbers', 'calendar', 'clickmode', 'coloraxis', 'colorscale', 'colorway', 'computed', 'datarevision', 'dragmode', 'editrevision', 'editType', 'font', 'geo', 'grid', 'height', 'hidesources', 'hoverdistance', 'hoverlabel', 'hovermode', 'images', 'legend', 'mapbox', 'margin', 'meta', 'metasrc', 'modebar', 'newshape', 'paper_bgcolor', 'plot_bgcolor', 'polar', 'scene', 'selectdirection', 'selectionrevision', 'separators', 'shapes', 'showlegend', 'sliders', 'smith', 'spikedistance', 'template', 'ternary', 'title', 'transition', 'uirevision', 'uniformtext', 'updatemenus', 'width', 'xaxis', 'yaxis', 'barmode', 'bargap', 'mapType'\n\n\nWarning: 'config' objects don't have these attributes: 'tooltip'\nValid attributes include:\n'autosizable', 'displaylogo', 'displayModeBar', 'doubleClick', 'doubleClickDelay', 'editable', 'edits', 'fillFrame', 'frameMargins', 'globalTransforms', 'linkText', 'locale', 'locales', 'logging', 'mapboxAccessToken', 'modeBarButtons', 'modeBarButtonsToAdd', 'modeBarButtonsToRemove', 'notifyOnLogging', 'plotGlPixelRatio', 'plotlyServerURL', 'queueLength', 'responsive', 'scrollZoom', 'sendData', 'setBackground', 'showAxisDragHandles', 'showAxisRangeEntryBoxes', 'showEditInChartStudio', 'showLink', 'showSendToCloud', 'showSources', 'showTips', 'staticPlot', 'toImageButtonOptions', 'topojsonURL', 'typesetMath', 'watermark'"
  },
  {
    "objectID": "greinar/visitala_neysluverds/index.html#samanburður-við-vægi-í-vísitölu-neysluverðs",
    "href": "greinar/visitala_neysluverds/index.html#samanburður-við-vægi-í-vísitölu-neysluverðs",
    "title": "Vísitala neysluverðs",
    "section": "Samanburður við vægi í vísitölu neysluverðs",
    "text": "Samanburður við vægi í vísitölu neysluverðs\n\n\nCode\nd_sam <- pxweb_get(\n  url =\"https://px.hagstofa.is:443/pxis/api/v1/is/Efnahagur/visitolur/2_samraemdvnv/samraemdvnv/VIS02201.px\", \n  query = list(\n    \"Flokkur\" = c(\"*\"),\n    \"Ár\" = c(\"*\")\n  ),\n  verbose = FALSE\n) |> \n  as.data.frame() |> \n  as_tibble() |> \n  janitor::clean_names() |> \n  rename(vaegi_samraemd = 3, undirvisitala = flokkur) |> \n  mutate(ar = parse_number(ar),\n         vaegi_samraemd = vaegi_samraemd / 1000) |> \n  filter(str_detect(undirvisitala, \"^[0-9]{2} \")) |> \n  mutate(undirvisitala = str_replace(undirvisitala, \"^[0-9]{2} \", \"\")) \n\n\nWarning in pxweb_as_data_frame.pxweb_data(x, row.names = row.names, optional =\noptional, : NAs introduced by coercion\n\n\n\n\nCode\nplot_dat <- d |> \n  filter(undirvisitala != \"Vísitala neysluverðs\") |> \n  select(date, undirvisitala, vaegi) |> \n  group_by(ar = year(date), undirvisitala) |> \n  summarise(vaegi = mean(vaegi)) |> \n  group_by(ar) |> \n  mutate(vaegi = vaegi / sum(vaegi)) |> \n  ungroup() |> \n  inner_join(\n    d_sam,\n    by = c(\"ar\", \"undirvisitala\")\n  ) |> \n  mutate(\n    undirvisitala = factor(undirvisitala, levels = levels(lvls$undirvisitala)),\n    text = str_c(\n      \"<b>\", undirvisitala, \"</b>\\n\",\n      \"Ár: \", ar, \"\\n\",\n      \"Vægi í vísitölu (Ísland): \", percent(vaegi, accuracy = 0.01), \"\\n\",\n      \"Vægi í vísitölu (Samræmd): \", percent(vaegi_samraemd, accuracy = 0.01))\n  )\n\n\n`summarise()` has grouped output by 'ar'. You can override using the `.groups`\nargument.\n\n\nCode\np <- plot_dat |> \n  ggplot(aes(vaegi, vaegi_samraemd, frame = ar, text = text)) +\n  geom_abline(intercept = 0, slope = 1) +\n  geom_point(aes(col = undirvisitala)) +\n  scale_x_continuous(labels = label_percent()) +\n  scale_y_continuous(labels = label_percent()) +\n  scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n  scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n  # theme_half_open() +\n  theme(legend.position = \"none\",\n        plot.margin = margin(t = 5, r = 15, b = 5, l = 5)) +\n  labs(x = \"Vægi á Íslandi\",\n       y = \"Samræmt vægi\",\n       title = \"Samanburður á íslensku og samræmdu vægi\")\n\nggplotly(\n  p,\n  tooltip = \"text\"\n) |> \n  animation_opts(\n    transition = 500,\n    redraw = FALSE\n    \n  ) |> \n  animation_slider(currentvalue = list(prefix = \"Ár:\")) |> \n  layout(\n    hoverlabel = list(align = \"left\")\n  ) |> \n  config(displayModeBar = FALSE)"
  },
  {
    "objectID": "greinar/landspitali/index.html",
    "href": "greinar/landspitali/index.html",
    "title": "Landspítalinn",
    "section": "",
    "text": "Gögnin eru fengin úr starfsemisupplýsingum Landspítala. Þar sem þetta er allt í PDF skjölum er ég ekki búinn að sækja öll gögnin, en ég birti hérna yfirlit yfir það helsta sem ég hef náð að safna saman. Það er kannski óþarfi að segja það, en það væri mikill kostur ef Landspítali myndi birta töflurnar úr þessum PDF skýrslum t.d. á csv formi, eða sem excel skrár. Seðlabankinn birtir t.d. excel skrár með viðeigandi gögnum samhliða PDF skýrslum sínum.\nEitt það besta sem yfirvöld geta gert til að auka traust á rekstri spítalans eða ákvarðanir í kringum hann er að auðvelda almenningi að nálgast upplýsingar um reksturinn. Það er ekki nóg að lesa/heyra í fjölmiðlum að einhver klár manneskja segir eitthvað um reksturinn, það verður að vera hægt að sannreyna þetta.\n\n\nCode\nd <- read_csv2(\"landspitali.csv\")\n\n\nℹ Using \"','\" as decimal and \"'.'\" as grouping mark. Use `read_delim()` for more control.\n\n\nRows: 17 Columns: 37\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \";\"\ndbl (37): ar, veikindahlutfall, starfsmannavelta, hjukrvelta, laeknavelta, s...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n\nCode\nvisitala <- pxweb_get(\n  url =\"https://px.hagstofa.is:443/pxis/api/v1/is/Efnahagur/visitolur/1_vnv/1_vnv/VIS01000.px\", \n  query = list(\n    \"Mánuður\" = c(\"*\"),\n    \"Vísitala\"  = c(\"CPI\"),\n    \"Liður\" = c(\"index\")\n  ),\n  verbose = FALSE\n) |> \n  as.data.frame() |> \n  as_tibble() |> \n  janitor::clean_names() |> \n  separate(manudur, into = c(\"ar\", \"manudur\"), sep = \"M\", convert = T) |> \n  mutate(manudur = str_pad(manudur, width = 2, side = \"left\", pad = \"0\"),\n         date = str_c(ar, \"-\", manudur, \"-01\") |> ymd()) |> \n  select(-manudur, -ar, -visitala, -lidur) |> \n  mutate(ar = year(date)) |> \n  group_by(ar) |> \n  filter(date == min(date)) |> \n  ungroup() |> \n  mutate(visitala_2022 = visitala_neysluverds / visitala_neysluverds[ar == 2022]) |> \n  select(-date, -visitala_neysluverds)\n\n\nurl_mannfjoldi <- \"https://px.hagstofa.is:443/pxis/api/v1/is/Ibuar/mannfjoldi/1_yfirlit/Yfirlit_mannfjolda/MAN00109.px\"\n\nquery_list_mannfjoldi <- list(\n  \"Ár\" = c(\"*\"),\n  \"Aldur\" = c(\"*\"),\n  \"Kyn\" = c(\"0\")\n)\n\n\nmannfjoldi <- pxweb_get(url_mannfjoldi, query = pxweb_query(query_list_mannfjoldi),\n                        verbose = FALSE) |> \n  as.data.frame() |> \n  as_tibble() |> \n  janitor::clean_names()  |> \n  filter(aldur == \"Alls\") |> \n  mutate(ar = parse_number(ar)) |> \n  group_by(ar) |> \n  summarise(mannfjoldi = sum(mannfjoldi_1841_2066))\n\nmannfjoldi <- pxweb_get(\n  url =\"https://px.hagstofa.is:443/pxis/api/v1/is/Ibuar/mannfjoldi/2_byggdir/sveitarfelog/MAN02005.px\", \n  query = list(\n    \"Sveitarfélag\" = c(\"*\"),\n    \"Aldur\" = c(\"-1\"),\n    \"Ár\" = c(\"*\"),\n    \"Kyn\" = c(\"0\")\n  ),\n  verbose = FALSE\n) |> \n  as.data.frame() |> \n  as_tibble() |> \n  janitor::clean_names() |> \n  rename(mannfjoldi = mannfjoldi_eftir_sveitarfelagi_kyni_og_aldri_1_januar_1998_2022) |> \n  mutate(ar = parse_number(ar)) |> \n  filter(sveitarfelag %in% c(\"Alls\", \"Reykjavíkurborg\", \"Garðabær\", \"Hafnarfjarðarkaupstaður\", \"Kópavogsbær\", \"Seltjarnarnesbær\", \"Mosfellsbær\")) |> \n  mutate(stadur = ifelse(sveitarfelag == \"Alls\", \"mannfjoldi_island\", \"mannfjoldi_hfbsv\")) |> \n  count(ar, stadur, wt = mannfjoldi) |> \n  pivot_wider(names_from = stadur, values_from = n)\n\nlands_laun <- read_csv(\"landspitali_laun.csv\") |> \n  rename(tegund_launa = tegund3,\n         samtals_laun = samtals)\n\n\nRows: 72 Columns: 3\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (1): tegund3\ndbl (2): ar, samtals\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n\nCode\nd <- d |> \n  inner_join(\n    visitala,\n    by = \"ar\"\n  ) |> \n  inner_join(\n    mannfjoldi,\n    by = \"ar\"\n  )"
  },
  {
    "objectID": "greinar/landspitali/index.html#læknar-hjúkrunarfræðingar-og-sjúkraliðar",
    "href": "greinar/landspitali/index.html#læknar-hjúkrunarfræðingar-og-sjúkraliðar",
    "title": "Landspítalinn",
    "section": "Læknar, Hjúkrunarfræðingar og Sjúkraliðar",
    "text": "Læknar, Hjúkrunarfræðingar og Sjúkraliðar\nÍ fréttum hefur verið talað um að of mikið starfsfólk sé ekki beintengt umönnun sjúklinga. Ein tilraun til að sannreyna þetta er að reikna hlutfall stöðugilda sem eru ekki hjúkrunarfræðingar, læknar eða sjúkraliðar. Þess ber þó að geta að meðlimir þessara stéttarfélaga geta líka sinnt stjórnenda/skrifstofustörfum að hluta til eða öllu leyti. Aðrar fagstéttir tengjast líka sjúklingum beint (t.d. sálfræðingar, lyfjafræðingar, meinafræðingar og sjúkraþjálfararar), en til einföldunar skoðum við hérna þessar þrjár stóru stéttir.\n\n\nCode\nplot_dat <- d |> \n  mutate(annad = stodugildi - stg_hjukr - stg_laekna - stg_sjukral,\n         hlutf_annad = annad / stodugildi) |> \n  select(ar, annad, hlutf_annad) |> \n  mutate(text = str_c(\"Ár: \", ar, \"\\n\",\n                      \"<b>Hlutfall: \", percent(hlutf_annad, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\"), \"</b>\\n\",\n                      \"Fjöldi: \", number(annad, suffix = \" stöðugildi\", big.mark = \".\", decimal.mark = \",\"), \"\\n\")) |> \n  drop_na()\n\np <- plot_dat |> \n  ggplot(aes(ar, hlutf_annad, text = text)) +\n  geom_line(aes(group = \"none\")) +\n  scale_x_continuous(expand = expansion(add = 0.6),\n                     breaks = 2006:2021) +\n  scale_y_continuous(expand = expansion(),\n                     labels = label_percent(),\n                     breaks = c(0.4, 0.45, 0.5, 0.55, 0.6),\n                     limits = c(0.4, 0.6)) +\n  scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n  scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n  theme(legend.position = \"none\") +\n  labs(x = NULL,\n       y = NULL,\n       title = \"Hlutfall stöðugilda Landspítala sem eru ekki hjúkrunarfræðingar, læknar eða sjúkraliðar\",\n       subtitle = \"Reiknað út frá starfsemisupplýsingum Landspítala um stöðugildi eftir stéttarfélögum\")\n\nggsave(plot = p +\n         scale_x_tufte(breaks = 2006:2021) +\n         scale_y_tufte(expand = expansion(),\n                       labels = label_percent(),\n                       limits = c(0.4, 0.6),\n                       breaks = c(range(plot_dat$hlutf_annad), 0.5, 0.45, 0.55, 0.6)) +\n         theme(plot.title = element_text(face = \"bold\")) +\n         labs(title =  \"Hlutfall stöðugilda Landspítala sem eru ekki hjúkrunarfræðingar, læknar eða sjúkraliðar\"), \n       filename = \"hlutf_ekki3.png\",\n       width = 8, height = 0.5 * 8, scale = 1.8,\n       bg = \"white\")\n\n\nScale for x is already present.\nAdding another scale for x, which will replace the existing scale.\nScale for y is already present.\nAdding another scale for y, which will replace the existing scale.\n\n\nCode\nggplotly(\n  p,\n  tooltip = \"text\"\n) |> \n  layout(hoverlabel = list(align = \"left\"))"
  },
  {
    "objectID": "greinar/landspitali/index.html#stéttarfélög",
    "href": "greinar/landspitali/index.html#stéttarfélög",
    "title": "Landspítalinn",
    "section": "Stéttarfélög",
    "text": "Stéttarfélög\nHér má sjá fjölda og hlutföll stöðugilda fyrir fleiri stéttarfélög. Þar sem Sameyki varð ekki til fyrr en 2019 lagði ég saman fjölda stöðugilda hjá viðeigandi stéttarfélögum fyrir þann tíma.\n\nHlutföllFjöldi\n\n\n\n\nCode\nplot_dat <- d |> \n  select(ar, stodugildi, starts_with(\"stg\"), -ends_with(\"svid\")) |> \n  drop_na() |> \n  pivot_longer(c(-ar, -stodugildi)) |> \n  group_by(ar) |> \n  mutate(annad = stodugildi - sum(value)) |> \n  pivot_wider(names_from = name, values_from = value) |> \n  pivot_longer(c(-ar, -stodugildi)) |> \n  mutate(name = fct_reorder(name, value * (name != \"annad\"))) |> \n  group_by(ar) |> \n  mutate(hlutf = value / sum(value)) |> \n  ungroup() |> \n  mutate(name = fct_recode(name,\n                           \"Annað\" = \"annad\",\n                           \"Hjúkrunarfræðingar\" = \"stg_hjukr\",\n                           \"Læknar\" = \"stg_laekna\",\n                           \"Sjúkraliðar\" = \"stg_sjukral\",\n                           \"Sameyki\" = \"stg_sameyki\",\n                           \"Sálfræðingar\" = \"stg_salfr\",\n                           \"Sjúkraþjálfarar\" = \"stg_sjukrathj\",\n                           \"Félagsráðgjafar\" = \"stg_felrad\",\n                           \"Lyfjafræðingar\" = \"stg_lyfjafr\",\n                           \"Iðjuþjálfar\" = \"stg_idjuthj\",\n                           \"Ljósmæður\" = \"stg_ljosmaedur\"),\n         text = str_c(\"<b>\", name, \"</b>\", \"\\n\",\n                      \"Ár: \", ar, \"\\n\",\n                      \"<b>Hlutfall: \", percent(hlutf, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\"), \"</b>\\n\",\n                      \"Fjöldi: \", number(value, suffix = \" stöðugildi\", big.mark = \".\", decimal.mark = \",\"), \"\\n\"))\n\np <- plot_dat |> \n  ggplot(aes(ar, value, text = text)) +\n  geom_col(aes(fill = name, col = name), width = 1, position = \"fill\") +\n  scale_x_continuous(expand = expansion(),\n                     breaks = 2010:2021) +\n  scale_y_continuous(expand = expansion(),\n                     labels = label_percent()) +\n  scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n  scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n  theme(legend.position = \"none\") +\n  labs(x = NULL,\n       y = NULL,\n       title = \"Dreifing stöðugilda á Landspítala eftir stéttarfélagi\")\n\nggplotly(\n  p,\n  tooltip = \"text\"\n) |> \n  layout(hoverlabel = list(align = \"left\"))\n\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <- d |> \n  select(ar, stodugildi, starts_with(\"stg\"), -ends_with(\"svid\")) |> \n  drop_na() |> \n  pivot_longer(c(-ar, -stodugildi)) |> \n  group_by(ar) |> \n  mutate(annad = stodugildi - sum(value)) |> \n  pivot_wider(names_from = name, values_from = value) |> \n  pivot_longer(c(-ar, -stodugildi)) |> \n  mutate(name = fct_reorder(name, value * (name != \"annad\"))) |> \n  group_by(ar) |> \n  mutate(hlutf = value / sum(value)) |> \n  ungroup() |> \n  mutate(name = fct_recode(name,\n                           \"Annað\" = \"annad\",\n                           \"Hjúkrunarfræðingar\" = \"stg_hjukr\",\n                           \"Læknar\" = \"stg_laekna\",\n                           \"Sjúkraliðar\" = \"stg_sjukral\",\n                           \"Sameyki\" = \"stg_sameyki\",\n                           \"Sálfræðingar\" = \"stg_salfr\",\n                           \"Sjúkraþjálfarar\" = \"stg_sjukrathj\",\n                           \"Félagsráðgjafar\" = \"stg_felrad\",\n                           \"Lyfjafræðingar\" = \"stg_lyfjafr\",\n                           \"Iðjuþjálfar\" = \"stg_idjuthj\",\n                           \"Ljósmæður\" = \"stg_ljosmaedur\"),\n         text = str_c(\"<b>\", name, \"</b>\", \"\\n\",\n                      \"Ár: \", ar, \"\\n\",\n                      \"Hlutfall: \", percent(hlutf, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                      \"<b>Fjöldi: \", number(value, suffix = \" stöðugildi\", big.mark = \".\", decimal.mark = \",\"), \"</b>\\n\"))\n\np <- plot_dat |> \n  ggplot(aes(ar, value, text = text)) +\n  geom_col(aes(fill = name, col = name), width = 1, position = \"stack\") +\n  scale_x_continuous(expand = expansion(),\n                     breaks = 2010:2021) +\n  scale_y_continuous(expand = expansion(),\n                     labels = label_number(big.mark = \".\", decimal.mark = \",\")) +\n  scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n  scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n  theme(legend.position = \"none\") +\n  labs(x = NULL,\n       y = NULL,\n       title = \"Fjöldi stöðugilda á Landspítala eftir stéttarfélagi\")\n\nggplotly(\n  p,\n  tooltip = \"text\"\n) |> \n  layout(hoverlabel = list(align = \"left\"))"
  },
  {
    "objectID": "greinar/landspitali/index.html#stoðþjónusta-yfirstjórnstjórnsýsla",
    "href": "greinar/landspitali/index.html#stoðþjónusta-yfirstjórnstjórnsýsla",
    "title": "Landspítalinn",
    "section": "Stoðþjónusta (Yfirstjórn/stjórnsýsla)",
    "text": "Stoðþjónusta (Yfirstjórn/stjórnsýsla)\nTexti og gögn frá Spurt og svarað um Landspítala þar sem er m.a. vitnað í skýrslu McKinsey frá 2020.\n\nStjórnendur við Landspítala eru ríflega 200 talsins en starfsmenn um 6000 í rúmlega 4500 stöðugildum, að meðaltali einn stjórnandi á hverja 26 starfsmenn. Samkvæmt hinu erlenda ráðgjafarfyrirtæki McKinsey er „yfirstjórn/stjórnsýsla“ hlutfallslega minnst á Landspítala (13,2%) borið saman við Sjúkrahúsið á Akureyri (15,5%) og erlend samanburðarsjúkrahús (allt að 21,2%).\n\n\nÍ stoðþjónustu á Landspítala voru 602 stöðugildi árið 2020 sem gerir 13,5% af heildarfjölda stöðugilda það árið (4462 stg). Þetta er sambærilegt hlutfall og á Sjúkrahúsinu á Akureyri og einnig því samanburðarsjúkrahúsi sem valið var til samanburðar í skýrslu McKinsey frá árinu 2020.\n\n\nÞrátt fyrir að koma ekki beint að þjónustu við sjúklinga gegnir þetta starfsfólk engu að síður mikilvægu hlutverki. Þannig verður spítali ekki rekinn án fólks sem býr til mat handa sjúklingum, útvegar fatnað handa hjúkrunarfræðingum, reiknar laun handa sjúkraliðum, tæknifólks sem viðheldur öndunarvélum, forriturum sem passa upp á sjúkraskrár og svo framvegis. Þess má geta að á árunum eftir hrun var sérstaklega skorið niður í hópi þessara starfsmanna.\n\n\nÞannig var hlutfall starfsmanna í stoðþjónustu af heildarfjölda stöðugilda 16,3% árið 2008 en er sem fyrr segir 13,5% árið 2021. Það er sérstakt markmið stjórnenda Landspítala að fjölga starfsfólki í stoðþjónustu svo faglært starfsfólk geti einbeitt sér að beinni þjónustu við sjúklinga og starfað í samræmi við menntun sína (e. Working from the top of your licence).\n\n\nHlutfallFjöldi\n\n\n\n\nCode\nplot_dat <- d |> \n  select(ar, hlutf_stodtj, stodugildi) |> \n  drop_na() |> \n  mutate(text = str_c(\"Ár: \", ar, \"\\n\",\n                      \"<b>Hlutfall: \", percent(hlutf_stodtj, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\"), \"</b>\\n\",\n                      \"Fjöldi: \", number(hlutf_stodtj * stodugildi, suffix = \" stöðugildi\", big.mark = \".\", decimal.mark = \",\"), \"\\n\")) |> \n  drop_na()\n\np <- plot_dat |> \n  ggplot(aes(ar, hlutf_stodtj, text = text)) +\n  geom_line(aes(group = \"none\"), alpha = 0.6, col = \"black\") +\n  scale_x_continuous(expand = expansion(add = 0.6),\n                     breaks = 2006:2021) +\n  scale_y_continuous(expand = expansion(),\n                     labels = label_percent(),\n                     breaks = seq(0, 0.2, by = 0.02),\n                     limits = c(0.1, 0.2)) +\n  scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n  scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n  theme(legend.position = \"none\") +\n  labs(x = NULL,\n       y = NULL,\n       title = \"Hlutfall stoðþjónustu af stöðugildum Landspítala\")\n\nggplotly(\n  p,\n  tooltip = \"text\"\n) |> \n  layout(hoverlabel = list(align = \"left\"))\n\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <- d |> \n  select(ar, hlutf_stodtj, stodugildi) |> \n  drop_na() |> \n  mutate(fjoldi = hlutf_stodtj * stodugildi,\n         text = str_c(\"Ár: \", ar, \"\\n\",\n                      \"Hlutfall: \", percent(hlutf_stodtj, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                      \"<b>Fjöldi: \", number(fjoldi, suffix = \" stöðugildi\", big.mark = \".\", decimal.mark = \",\"), \"</b>\")) |> \n  drop_na()\n\np <- plot_dat |> \n  ggplot(aes(ar, fjoldi, text = text)) +\n  geom_area(aes(group = \"none\"), alpha = 0.6, col = \"black\") +\n  scale_x_continuous(expand = expansion(add = 0.6),\n                     breaks = 2006:2021) +\n  scale_y_continuous(expand = expansion(),\n                     labels = label_number(),\n                     limits = c(0, NA)) +\n  scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n  scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n  theme_half_open() +\n  theme(legend.position = \"none\") +\n  labs(x = NULL,\n       y = NULL,\n       title = \"Fjöldi stöðugilda stoðþjónustu á Landspítala (2008 - 2020)\")\n\nggplotly(\n  p,\n  tooltip = \"text\"\n) |> \n  layout(hoverlabel = list(align = \"left\"))"
  },
  {
    "objectID": "greinar/landspitali/index.html#stjórnendur",
    "href": "greinar/landspitali/index.html#stjórnendur",
    "title": "Landspítalinn",
    "section": "Stjórnendur",
    "text": "Stjórnendur\nFyrir tæpu ári síðan birti Landspítali Samantekt um stjórnendur á Landspítala og laun þeirra. Þar getum við séð hlutfall stjórnenda af öllum stöðugildum og notað svo gögnin um heildarfjölda stöðugilda til að reikna fjölda stöðugilda stjórnenda. Eins og sést að neðan hefur hlutfallið farið stöðugt lækkandi frá 2008 til 2020, og fjöldi stöðugilda stjórnenda lækkað eða haldist í stað.\n\nHlutfallFjöldi\n\n\n\n\nCode\nplot_dat <- d |> \n  select(ar, hlutf_stjornendur, stodugildi) |> \n  drop_na() |> \n  mutate(text = str_c(\"Ár: \", ar, \"\\n\",\n                      \"<b>Hlutfall: \", percent(hlutf_stjornendur, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\"), \"</b>\\n\",\n                      \"Fjöldi: \", number(hlutf_stjornendur * stodugildi, suffix = \" stöðugildi\", big.mark = \".\", decimal.mark = \",\"), \"\\n\")) |> \n  drop_na()\n\np <- plot_dat |> \n  ggplot(aes(ar, hlutf_stjornendur, text = text)) +\n  geom_line(aes(group = \"none\"), alpha = 0.6, col = \"black\") +\n  scale_x_continuous(expand = expansion(add = 0.6),\n                     breaks = 2006:2021) +\n  scale_y_continuous(expand = expansion(),\n                     labels = label_percent(),\n                     breaks = 0:10/100,\n                     limits = c(0.02, 0.07)) +\n  scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n  scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n  theme(legend.position = \"none\") +\n  labs(x = NULL,\n       y = NULL,\n       title = \"Hlutfall stjórnenda af stöðugildum Landspítala\",\n       subtitle = \"Árið 2008 voru stjórnendur 5,9% af stöðugildum en 4,7% árið 2020.\")\n\nggsave(plot = p +\n         geom_rangeframe() +\n         theme_tufte() +\n         scale_y_continuous(expand = expansion(),\n                            labels = label_percent(accuracy = 0.1),\n                            limits = c(0.03, 0.07),\n                            breaks = c(range(plot_dat$hlutf_stjornendur), \n                                       0, 0.03, 0.04, 0.05, 0.055, 0.07)) +\n         theme(plot.title = element_text(face = \"bold\")), \n       filename = \"hlutf_stjornendur.png\",\n       width = 8, height = 0.5 * 8, scale = 1.5,\n       bg = \"white\")\n\n\nScale for y is already present.\nAdding another scale for y, which will replace the existing scale.\n\n\nCode\nggplotly(\n  p,\n  tooltip = \"text\"\n) |> \n  layout(hoverlabel = list(align = \"left\"))\n\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <- d |> \n  select(ar, hlutf_stjornendur, stodugildi) |> \n  drop_na() |> \n  mutate(fjoldi = hlutf_stjornendur * stodugildi,\n         text = str_c(\"Ár: \", ar, \"\\n\",\n                      \"Hlutfall: \", percent(hlutf_stjornendur, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                      \"<b>Fjöldi: \", number(fjoldi, suffix = \" stöðugildi\", big.mark = \".\", decimal.mark = \",\"), \"</b>\")) |> \n  drop_na()\n\np <- plot_dat |> \n  ggplot(aes(ar, fjoldi, text = text)) +\n  geom_area(aes(group = \"none\"), alpha = 0.6, col = \"black\") +\n  scale_x_continuous(expand = expansion(add = 0.6),\n                     breaks = 2006:2021) +\n  scale_y_continuous(expand = expansion(),\n                     labels = label_number(),\n                     limits = c(0, NA)) +\n  scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n  scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n  theme(legend.position = \"none\") +\n  labs(x = NULL,\n       y = NULL,\n       title = \"Fjöldi stöðugilda stjórnenda á Landspítala\",\n       subtitle = \"Árið 2008 voru stöðugildi stjórnenda 229,2 en voru 208,3 árið 2020\")\n\nggplotly(\n  p,\n  tooltip = \"text\"\n) |> \n  layout(hoverlabel = list(align = \"left\"))"
  },
  {
    "objectID": "greinar/landspitali/index.html#skrifstofa",
    "href": "greinar/landspitali/index.html#skrifstofa",
    "title": "Landspítalinn",
    "section": "Skrifstofa",
    "text": "Skrifstofa\nFyrir nokkrum árum endurskilgreindi Landspítali starfsemissviðin sín og tók að nota færri yfirsvið í starfsemisupplýsingum sínum. Í starfemisupplýsingum má sjá að stöðugildum hefur fjölgað á Skrifstofusviði, en þessi fjölgun þýðir ekki að skrifstofufólki hefur fjölgað heldur hefur verið að færa starfsemi á milli sviða. Ég bendi áhugasömum á Spurt og svarað um Landspítala.\n\n\nCode\nknitr::include_graphics(\"skrifstof_landsp.png\")\n\n\n\n\n\nTilkynning vegna skrifstofustöðugilda"
  },
  {
    "objectID": "greinar/landspitali/index.html#á-höfðatölu",
    "href": "greinar/landspitali/index.html#á-höfðatölu",
    "title": "Landspítalinn",
    "section": "Á höfðatölu",
    "text": "Á höfðatölu\n\n\nCode\nd <- read_csv(\"data.csv\") |> \n  mutate(text = str_c(\"Ár: \", ar, \"\\n\",\n                      \"Launaútgjöld: \", number(laun, suffix = \" kr\", big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                      \"Mannfjöldi (heild): \", number(pop, big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                      \"Mannfjöldi (65+): \", number(pop_65, big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                      \"Laun per íbúi (heild): \", number(laun_per_pers, suffix = \" kr\", big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                      \"Laun per íbúi (65+): \", number(laun_per_pers_65, suffix = \" kr\", big.mark = \".\", decimal.mark = \",\")))\n\n\nRows: 18 Columns: 7\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\ndbl (7): ar, laun, pop_65, pop, cpi, laun_per_pers, laun_per_pers_65\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n\nVið getum svo notað tölur Hagstofu um mannfjölda eftir aldri til að reikna launaútgjöld á höfðatölu, bæði fyrir alla íbúa og fyrir íbúa sem hafa náð 65 ára aldri.\nUpphæðirnar að neðan eru leiðréttar fyrir verðbólgu með vísitölu neysluverðs.\n\nAllir65+\n\n\nEf við skoðum launaútgjöld á hvern íbúa sýnist okkur að launaútgjöldin hafa aldrei verið hærri.\n\n\nCode\np <- d |> \n  ggplot(aes(x = ar, y = laun_per_pers, text = text)) +\n  geom_area(aes(group = \"none\"), alpha = 0.6, col = \"black\") +\n  scale_x_continuous(breaks = seq(1999, 2021, by = 2)) +\n  scale_y_continuous(labels = label_number(suffix = \" kr\", \n                                           big.mark = \".\", decimal.mark = \",\"),\n                     expand = expansion()) +\n  coord_cartesian(ylim = c(0, NA)) +\n  labs(x = NULL,\n       y = NULL,\n       title = \"Launaútgjöld til Landspítala á íbúa\")\n\nggplotly(\n  p,\n  tooltip = \"text\"\n)\n\n\n\n\n\n\n\n\nEn þegar við skoðum launaútgjöld á hvern íbúa sem hefur náð 65 ára aldri eru við rétt að komast upp í sömu fjárhæð og árið 2007.\n\n\nCode\np <- d |> \n  ggplot(aes(x = ar, y = laun_per_pers_65, text = text)) +\n  geom_area(aes(group = \"none\"), alpha = 0.6, col = \"black\") +\n  scale_x_continuous(breaks = seq(1999, 2021, by = 2)) +\n  scale_y_continuous(labels = label_number(suffix = \" kr\", \n                                           big.mark = \".\", decimal.mark = \",\"),\n                     expand = expansion()) +\n  labs(x = NULL,\n       y = NULL,\n       title = \"Launaútgjöld til Landspítala á 65+ ára íbúa\")\n\nggplotly(\n  p,\n  tooltip = \"text\"\n)"
  },
  {
    "objectID": "greinar/leikskolar/index.html",
    "href": "greinar/leikskolar/index.html",
    "title": "Leikskólar",
    "section": "",
    "text": "Hagstofan gefur árlega út gögn um fjölda nemenda í leikskólum landsins. Tölurnar eiga við um fjöldann í desembermánuði árið á undan. Til að fá sem raunsæsta mynd á hlutfall barna með leikskólapláss er best að bera þann fjölda saman við stærð árgangsins í janúar mánuði síðar.\n\nEins árs gömul börn\n\n\nCode\np <- d |> \n  filter(\n    aldur == \"1 árs\",\n    ar == 2021,\n    n_heild > 20\n  ) |> \n  mutate(\n    hlutf = n_leik / n_heild,\n    name = str_c(\n      sveitarfelag, \" [\", n_leik, \"/\", n_heild, \"]\"\n    ),\n    name = fct_reorder(name, hlutf)\n  ) |> \n  ggplot(aes(hlutf, name)) +\n  geom_col() +\n  scale_x_continuous(\n    limits = c(0, 1),\n    expand = expansion(),\n    labels = label_percent()\n  ) +\n  coord_cartesian(clip = \"off\") +\n  theme(\n    plot.margin = margin(t = 5, r = 15, b = 5, l = 5)\n  ) +\n  labs(\n    x = NULL,\n    y = NULL,\n    title = \"Hvar eru flest 12-23 mánaða gömul börn með leikskólapláss?\",\n    subtitle = \"Sýnt fyrir sveitarfélög með fleiri en 20 eins árs gömul börn í janúar 2022\",\n    caption = \"Mynd frá metill.is byggð á gögnum Hagstofu um Börn og leikskóla í desember 1998 - 2021\"\n  )\n\nggsave(\n  plot = p,\n  filename = \"Figures/ordered_2021.png\",\n  width = 8, height = 0.621 * 8, scale = 1.3\n)\n\nggsave(\n  plot = p +\n    theme(plot.background = element_blank(),\n          panel.background = element_blank()),\n  filename = \"Figures/ordered_2021_fp.png\",\n  width = 8, height = 0.621 * 8, scale = 1.3\n)\n\n\nMest er talað um fjölda eins árs barna svo við byrjum á að skoða þær tölur\n\n\n\nCode\nplot_dat <- d |> \n  filter(\n    aldur == \"1 árs\",\n  ) |> \n  semi_join(\n    d |> \n      filter(aldur == \"1 árs\") |> \n      group_by(sveitarfelag) |> \n      summarise(n_leik = mean(n_leik)) |> \n      ungroup() |> \n      top_n(16, wt = n_leik),\n    by = \"sveitarfelag\"\n  ) |> \n  mutate(n_leik = pmin(n_leik, n_heild),\n         hlutf = n_leik / n_heild,\n         hlutf = pmin(1, hlutf),\n         hlutf = pmax(0, hlutf)) |> \n  group_by(sveitarfelag) |> \n  group_modify(\n    function(x, ...) {\n      gam(hlutf ~ s(ar), data = x, family = binomial(), weight = n_heild) |> \n        emmeans(~ ar, at = list(ar = unique(x$ar))) |> \n        tidy(type = \"response\") |> \n        mutate(n_leik = x$n_leik,\n               n_heild = x$n_heild,\n               hlutf = n_leik / n_heild)\n    }\n  ) |> \n  ungroup()\n\n\np <- plot_dat |> \n  ggplot(aes(ar, prob)) +\n  geom_line(\n    data = plot_dat |> rename(svf = sveitarfelag),\n    aes(group = svf),\n    alpha = 0.2\n  ) +\n  geom_line() +\n  geom_point(aes(y = hlutf), size = 1) +\n  scale_x_continuous(\n    expand = expansion(add = 0.2)\n  ) +\n  scale_y_continuous(\n    labels = label_percent(),\n    expand = expansion()\n  ) +\n  facet_wrap(\"sveitarfelag\") +\n  coord_cartesian(clip = \"off\") +\n  labs(\n    x = NULL,\n    y = NULL,\n    title = \"Hlutfall barna á aldrinum 12 - 23 mánaða með leikskólapláss\",\n    subtitle = \"Hlutfall reiknað sem fjöldi barna með leikskólapláss í desember deilt með fjölda í árgangi mánuði seinna\",\n    caption = \"Mynd frá metill.is byggð á gögnum Hagstofu um Börn og leikskóla í desember 1998 - 2021\"\n  )\n\nggsave(\n  plot = p,\n  filename = \"Figures/hlutf_1ars.png\",\n  width = 8, height = 0.621 * 8, scale = 1.5\n)\n\n\nEn hvernig hefur þetta hlutfall þróast undanfarin ár? Skoðum þróunina hjá þeim 16 sveitarfélögum sem hafa haft stærstu árgangana síðustu árin\n\n\n\nHeildarfjöldi leikskólaplássa\nEndurtökum þetta nú fyrir leikskólana í heild sinni. Þá skoðum við heildarfjölda nemenda í leikskólum sem hlutfall af fjölda barna á aldrinum 1 árs til 5 ára. Við sjáum að neðan að stundum benda gögnin til þess að fleiri börn eru í leikskólum heldur en eru í árganginum. Þetta getur alltaf gerst þar sem við erum að skoða fjöldatölur í árgangi mánuði seinna en fjöldatölur í leikskólum.\n\n\nCode\np <- d |> \n  filter(\n    ar == 2021,\n    aldur != \"Á fyrsta ári\"\n  ) |> \n  group_by(sveitarfelag) |> \n  summarise(\n    n_leik = sum(n_leik),\n    n_heild = sum(n_heild),\n    .groups = \"drop\"\n  ) |> \n  top_n(35, wt = n_heild) |> \n  mutate(\n    hlutf = n_leik / n_heild,\n    hlutf = pmin(1, hlutf),\n    name = str_c(\n      sveitarfelag, \" [\", n_leik, \"/\", n_heild, \"]\"\n    ),\n    name = fct_reorder(name, hlutf)\n  ) |> \n  ggplot(aes(hlutf, name)) +\n  geom_col() +\n  scale_x_continuous(\n    limits = c(0, 1),\n    expand = expansion(),\n    labels = label_percent()\n  ) +\n  coord_cartesian(clip = \"off\") +\n  theme(\n    plot.margin = margin(t = 5, r = 15, b = 5, l = 5)\n  ) +\n  labs(\n    x = NULL,\n    y = NULL,\n    title = \"Hvar eru flest börn með leikskólapláss?\",\n    subtitle = \"Heildarfjöldi leikskólaplássa sem hlutfall af heildarfjölda á aldrinum 1 árs til 5 ára\",\n    caption = \"Mynd frá metill.is byggð á gögnum Hagstofu um Börn og leikskóla í desember 1998 - 2021\"\n  )\n\nggsave(\n  plot = p,\n  filename = \"Figures/ordered_total_2021.png\",\n  width = 8, height = 0.8 * 8, scale = 1.3\n)\n\nggsave(\n  plot = p +\n    theme(plot.background = element_blank(),\n          panel.background = element_blank()),\n  filename = \"Figures/ordered_total_2021_fp.png\",\n  width = 8, height = 0.621 * 8, scale = 1.3\n)\n\n\n\n\n\nCode\nplot_dat <- d |> \n  filter(aldur != \"Á fyrsta ári\") |> \n  semi_join(\n    d |> \n      filter(aldur == \"1 árs\") |> \n      group_by(sveitarfelag) |> \n      summarise(n_leik = mean(n_leik)) |> \n      ungroup() |> \n      top_n(16, wt = n_leik),\n    by = \"sveitarfelag\"\n  ) |> \n  group_by(sveitarfelag, ar) |> \n  summarise(\n    n_leik = sum(n_leik),\n    n_heild = sum(n_heild),\n    .groups = \"drop\"\n  ) |> \n  mutate(n_leik = pmin(n_leik, n_heild),\n         hlutf = n_leik / n_heild,\n         hlutf = pmin(1, hlutf),\n         hlutf = pmax(0, hlutf)) |> \n  group_by(sveitarfelag) |> \n  group_modify(\n    function(x, ...) {\n      gam(hlutf ~ s(ar), data = x, family = binomial(), weight = n_heild) |> \n        emmeans(~ ar, at = list(ar = unique(x$ar))) |> \n        tidy(type = \"response\") |> \n        mutate(n_leik = x$n_leik,\n               n_heild = x$n_heild,\n               hlutf = n_leik / n_heild)\n    }\n  ) |> \n  ungroup()\n\n\np <- plot_dat |> \n  ggplot(aes(ar, prob)) +\n  geom_line(\n    data = plot_dat |> rename(svf = sveitarfelag),\n    aes(group = svf),\n    alpha = 0.2\n  ) +\n  geom_line() +\n  geom_point(aes(y = hlutf), size = 1) +\n  scale_x_continuous(\n    expand = expansion(add = 0.2)\n  ) +\n  scale_y_continuous(\n    labels = label_percent(),\n    expand = expansion()\n  ) +\n  facet_wrap(\"sveitarfelag\") +\n  coord_cartesian(clip = \"on\", ylim = c(0.4, 1)) +\n  labs(\n    x = NULL,\n    y = NULL,\n    title = \"Hlutfall barna með leikskólapláss\",\n    subtitle = \"Hlutfall reiknað sem fjöldi barna með leikskólapláss í desember deilt með fjölda í árgangi mánuði seinna\",\n    caption = \"Mynd frá metill.is byggð á gögnum Hagstofu um Börn og leikskóla í desember 1998 - 2021\"\n  )\n\nggsave(\n  plot = p,\n  filename = \"Figures/hlutf_total.png\",\n  width = 8, height = 0.621 * 8, scale = 1.5\n)\n\n\nSkoðum þróunina núna fyrir sömu 16 sveitarfélög og að ofan."
  },
  {
    "objectID": "greinar/skattagogn/index.html",
    "href": "greinar/skattagogn/index.html",
    "title": "Tekjur, skattar og kaupmáttur",
    "section": "",
    "text": "Code\nplot_dat <- d |> \n  filter(tiundarbreyta == \"Heildartekjur\",\n         name %in% c(\"Tekjur alls\", \"Fjöldi í hóp\"),\n         ar == 2021) |> \n  pivot_wider(names_from = name, values_from = value) |> \n  janitor::clean_names()\n\nfjoldi <- number(sum(plot_dat$fjoldi_i_hop), big.mark = \".\", decimal.mark = \",\")\ntekjur <- number(sum(plot_dat$tekjur_alls), big.mark = \".\", decimal.mark = \",\")\ntekjur_a_mann <- number(sum(plot_dat$tekjur_alls) / sum(plot_dat$fjoldi_i_hop), acrucay = 0.1, big.mark = \".\", decimal.mark = \",\")\ntekjur_a_mann_a_manudi <- number(sum(plot_dat$tekjur_alls) / sum(plot_dat$fjoldi_i_hop) / 12, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\")\n\n\nÞað er fátt jafn sexý og þegar einhver talar um tekjutíundir, en hvað þýðir það? Í gögnum Hagstofunnar um tekjur eru samtals 230.401 einstaklingar og þau fengu samtals tekjur upp á 2.182.908 milljónir króna, eða 9 milljónir króna á mann á ári (0,8 milljónir á mánuði).\nEn þessir einstaklingar höfðu ekki allir sömu tekjur, heldur er tekjum dreift ójafnt. Sum hafa hærri tekjur og aðrir lægri. Ímyndum að við tökum þessa 230.401 einstaklinga, röðum þeim í vaxandi röð eftir tekjum þeirra og skiptum svo í tíu jafnstóra hópa. Þá erum við komin með það sem kallast tekjutíundir! Í töflu I að neðan sjáum við hvernig heildartekjur skiptust í tekjutíundir árið 2021.\nHér ber að hafa í huga að allir einstaklingar sem náð hafa 16 ára aldri teljast með í þessum gögnum. Því þýða mánaðartekjur upp á 37 þúsund kr í lægstu tíundinni ekki að fjölskyldur þurfi að lifa á þeim tekjum, heldur eru þarna margir einstaklingar með engar eða mjög litlar tekjur.\n\n\nCode\nplot_dat |> \n  mutate(\n    p = tekjur_alls / sum(tekjur_alls),\n    p = percent(p, decimal.mark = \",\", big.mark = \".\"),\n    tekjur_a_mann = tekjur_alls / fjoldi_i_hop * 1e6 / 12,\n    tekjur_a_mann = number(\n      tekjur_a_mann, suffix = \" kr\", decimal.mark = \",\", big.mark = \".\"\n    ),\n    tekjur_a_mann = ifelse(\n      tiundarhluti == 1, \n      str_c(\n        tekjur_a_mann, \n        footnote_marker_alphabet(1, format = \"html\")\n      ),\n      tekjur_a_mann\n    ),\n    tekjur_alls = number(\n      tekjur_alls, suffix = \" mkr\", decimal.mark = \",\", big.mark = \".\"\n    )\n  ) |> \n  select(tiundarhluti, tekjur_a_mann, tekjur_alls, p) |> \n  kable(\n    format = \"html\",\n    col.names = c(\"Tekjutíund\", \"Tekjur á mann<br>(á mánuði)\", \"Tekjur alls\", \"Hlutfall allra tekna\"), \n    escape = FALSE, \n    align = c(\"c\", \"c\", \"c\", \"c\"),\n    caption = \"Tafla I. Skipting heildartekna á tekjutíundir árið 2021\"\n  ) |> \n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"), full_width = FALSE) |> \n  footnote(alphabet = c(\"Einstaklingar á aldrinum 16-17 hafa oft engar eða litlar tekjur meirihluta árs.\"), fixed_small_size = T)\n\n\n\n\nTafla I. Skipting heildartekna á tekjutíundir árið 2021\n \n  \n    Tekjutíund \n    Tekjur á mann(á mánuði) \n    Tekjur alls \n    Hlutfall allra tekna \n  \n \n\n  \n    1 \n    37.203 kra \n    10.286 mkr \n    0,5% \n  \n  \n    2 \n    169.083 kr \n    46.748 mkr \n    2,1% \n  \n  \n    3 \n    303.747 kr \n    83.980 mkr \n    3,8% \n  \n  \n    4 \n    402.825 kr \n    111.373 mkr \n    5,1% \n  \n  \n    5 \n    490.488 kr \n    135.610 mkr \n    6,2% \n  \n  \n    6 \n    614.343 kr \n    169.861 mkr \n    7,8% \n  \n  \n    7 \n    780.465 kr \n    215.783 mkr \n    9,9% \n  \n  \n    8 \n    1.011.961 kr \n    279.787 mkr \n    12,8% \n  \n  \n    9 \n    1.370.797 kr \n    378.998 mkr \n    17,4% \n  \n  \n    10 \n    2.714.417 kr \n    750.482 mkr \n    34,4% \n  \n\n\na Einstaklingar á aldrinum 16-17 hafa oft engar eða litlar tekjur meirihluta árs.\n\n\n\n\nVið getum skipt öðrum breytum en tekjum í tíundir. Í mælaborðinu mínu um skattahögn Hagstofunnar er hægt að skoða ýmsar breytur eftir tíundum heildartekna, ráðstöfunartekna, eigna og annarra breytna!"
  },
  {
    "objectID": "greinar/skattagogn/index.html#hversu-hátt-hlutfall-af-öllum-sköttum-borgar-hver-tekjuhópur",
    "href": "greinar/skattagogn/index.html#hversu-hátt-hlutfall-af-öllum-sköttum-borgar-hver-tekjuhópur",
    "title": "Tekjur, skattar og kaupmáttur",
    "section": "Hversu hátt hlutfall af öllum sköttum borgar hver tekjuhópur?",
    "text": "Hversu hátt hlutfall af öllum sköttum borgar hver tekjuhópur?\nÞað ætti ekki að koma á óvart að efri tekjutíundir borgi hærra hlutfall af öllum sköttum heldur en lægri tíundir. Fjármálaráðuneytið benti á það í tilkynningu þann 23. júní 2021 að efstu fimm tekjutíundirnar borgi 83% af öllum sköttum. Er þetta eftirtektarvert? Út frá töflunni okkar að ofan getum við séð að efstu fimm tíundirnar fá\n\\[\n34.4\\% + 17.4\\% + 12.8\\% + 9.9\\% + 7.8\\% = 82.3\\%\n\\]\naf öllum tekjum, og því ætti það alls ekki að koma okkur á óvart að þau borgi það hátt hlutfall af öllum sköttum. Þessi tala, 83%, þýðir því ekki að það sé vegið að þeim tekuhærri á óréttlátan hátt.\nEn hvað borgar hver tekjutíund mikið í skatta og hvernig ber því saman við heildartekjur þeirra? Á myndinni að neðan ber ég þetta tvennt saman. Hægt er að smella á Play til að sjá þróunina frá 1997 til 2021 eða velja ár til að skoða. Ef allir tekjuhópar borguðu jafnt hlutfall í skatta væru allir punktarnir á brotnu línunni.\n\n\nCode\nplot_dat <- d |>\n  filter(tiundarbreyta %in% \"Heildartekjur\",\n         name %in% c(\"Tekjur alls\", \n                     \"Skattar alls\",\n                     \"Fjöldi í hóp\")) |> \n  pivot_wider() |> \n  rename(fjoldi = \"Fjöldi í hóp\") |> \n  pivot_longer(c(-ar, -tiundarbreyta, -tiundarhluti, -fjoldi)) |> \n  group_by(ar, name) |> \n  mutate(p = value / sum(value)) |> \n  ungroup()\n\n\nplot_dat <- plot_dat |> \n  select(-tiundarbreyta, -value) |> \n  pivot_wider(names_from = name, values_from = p) |> \n  janitor::clean_names() |> \n  rename(tekjur_hlutf = tekjur_alls, skattar_hlutf = skattar_alls) |> \n  inner_join(\n    plot_dat |> \n      select(-tiundarbreyta, -p) |> \n      pivot_wider(names_from = name, values_from = value) |> \n      janitor::clean_names(),\n    by = c(\"ar\", \"tiundarhluti\", \"fjoldi\")\n  ) |> \n  inner_join(\n    vnv() |> \n      group_by(ar = year(date)) |> \n      summarise(visitala = mean(cpi),\n                .groups = \"drop\") |> \n      mutate(visitala = visitala / visitala[ar == max(ar)]),\n    by = \"ar\"\n  ) |> \n  mutate(tekjur_alls = tekjur_alls / visitala,\n         skattar_alls = skattar_alls / visitala,\n         skattar_hlutf_tekjum = skattar_alls / tekjur_alls) |> \n  mutate(text = str_c(\"<b>Tekjutíund: \", tiundarhluti, \"</b>\", \"\\n\",\n                      \"Ár: \", ar, \"\\n\",\n                      \"Tekjur (á mann á mánuði): \", number(tekjur_alls * 1e6 / (fjoldi * 12), suffix = \" kr\", big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                      \"% allra tekna: \", percent(tekjur_hlutf, accuracy = 0.1), \"\\n\",\n                      \"Skattar (á mann á mánuði): \", number(skattar_alls * 1e6 / (fjoldi * 12), suffix = \" kr\", big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                      \"% allra skatta: \", percent(skattar_hlutf, accuracy = 0.1), \"\\n\",\n                      \"Skattbyrði (% af tekjum): \", percent(skattar_hlutf_tekjum, accuracy = 0.1)))\n\n\n\np <- plot_dat |> \n  ggplot(aes(tekjur_hlutf, skattar_hlutf, \n             frame = ar, text = text)) +\n  geom_abline(intercept = 0, slope = 1, lty = 2) +\n  geom_point() +\n  scale_x_continuous(labels = label_percent(),\n                     expand = expansion(),\n                     limits = c(min(plot_dat$skattar_hlutf), 0.5),\n                     breaks = seq(0, 50, by = 10)/100) +\n  scale_y_continuous(labels = label_percent(),\n                     expand = expansion(),\n                     limits = c(min(plot_dat$skattar_hlutf), 0.5),\n                     breaks = seq(0, 50, by = 10)/100) +\n  theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5)) +\n  labs(x = \"% af öllum tekjum\",\n       y = \"% af öllum sköttum\",\n       title = \"Hvað fær hver tekjutíund háa % af öllum tekjum og sköttum?\")\n\n\nggplotly(\n  p,\n  tooltip = \"text\"\n) |> \n  animation_opts(\n    transition = 500,\n    redraw = FALSE\n    \n  ) |> \n  animation_slider(currentvalue = list(prefix = \"Ár:\")) |> \n  layout(\n    hoverlabel = list(align = \"left\")\n  ) |> \n  config(displayModeBar = FALSE)"
  },
  {
    "objectID": "greinar/skattagogn/index.html#skattbyrði",
    "href": "greinar/skattagogn/index.html#skattbyrði",
    "title": "Tekjur, skattar og kaupmáttur",
    "section": "Skattbyrði",
    "text": "Skattbyrði\nVið getum líka skoðað skattbyrði, eða hversu hátt hlutfall af tekjum sínum hver hópur borgar í skatta. Eins og að ofan er hægt að smella á Play til að sjá þróunina frá 1997 til 2021 eða velja ár sjálf til að skoða. Í sömu tilkynningu frá fjármálaráðuneytinu og ég nefndi að ofan var bent á að skattbyrði allra tekjutíunda nema þeirri efstu hefði lækkað frá 2019 til 2021. Það er rétt, en það er gott að hafa í huga að skattbyrði sömu tíunda hækkaði flestöll árin frá 1997 til 2019.\nNeðar í færslunni mun ég svo sýna hvernig skattbyrði hefur hækkað síðan 1997 hjá öllum tekjutíundum nema þeirri efstu.\n\n\nCode\nplot_dat <- plot_dat |> \n  mutate(\n    text = str_c(\"<b>Tekjutíund: \", tiundarhluti, \"</b>\", \"\\n\",\n                 \"Ár: \", ar, \"\\n\",\n                 \"Tekjur (á mann á mánuði): \", number(tekjur_alls * 1e6 / (fjoldi * 12), suffix = \" kr\", big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                 \"% allra tekna: \", percent(tekjur_hlutf, accuracy = 0.1), \"\\n\",\n                 \"Skattar (á mann á mánuði): \", number(skattar_alls * 1e6 / (fjoldi * 12), suffix = \" kr\", big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                 \"% allra skatta: \", percent(skattar_hlutf, accuracy = 0.1), \"\\n\",\n                 \"<b>Skattbyrði (% af tekjum): \", percent(skattar_hlutf_tekjum, accuracy = 0.1), \"</b>\")\n  )\np <- plot_dat |> \n  ggplot(aes(tiundarhluti, skattar_hlutf_tekjum, \n             frame = ar, text = text)) +\n  geom_line(aes(group = \"none\")) +\n  geom_point() +\n  scale_x_continuous(expand = expansion(add = 0.05),\n                     breaks = seq(0, 10, by = 1)) +\n  scale_y_continuous(labels = label_percent(),\n                     expand = expansion(add = 0.002),\n                     breaks = seq(0, 50, by = 10)/100) +\n  theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5)) +\n  labs(x = \"Tekjutíund\",\n       y = \"Skattbyrðu (Skattar sem % af tekjum)\",\n       title = \"Skattbyrði eftir tekjutíund\")\n\n\nggplotly(\n  p,\n  tooltip = \"text\"\n) |> \n  animation_opts(\n    transition = 500,\n    redraw = FALSE\n    \n  ) |> \n  animation_slider(currentvalue = list(prefix = \"Ár:\")) |> \n  layout(\n    hoverlabel = list(align = \"left\")\n  ) |> \n  config(displayModeBar = FALSE)"
  },
  {
    "objectID": "greinar/skattagogn/index.html#kaupmáttur-heildartekna",
    "href": "greinar/skattagogn/index.html#kaupmáttur-heildartekna",
    "title": "Tekjur, skattar og kaupmáttur",
    "section": "Kaupmáttur heildartekna",
    "text": "Kaupmáttur heildartekna\nKaupmáttur er einfaldlega hækkun á tekjum umfram verðbólgu (hækkun á verðlagi, mælt með vísitölu neysluverðs). Hér sjáum við hækkun kaupmáttar frá 1997 hjá meðaleinstakling úr hverru tekjutíund.\n\n\nCode\nplot_dat <- d |> \n  filter(tiundarbreyta == \"Heildartekjur\",\n         name %in% c(\"Tekjur alls\", \"Fjöldi í hóp\")) |> \n  pivot_wider() |> \n  rename(fjoldi = \"Fjöldi í hóp\") |> \n  pivot_longer(c(-ar, -tiundarbreyta, -tiundarhluti, -fjoldi)) |> \n  group_by(ar, name) |> \n  mutate(p = value / sum(value)) |> \n  ungroup() |> \n  select(-tiundarbreyta) |> \n  inner_join(\n    vnv() |> \n      group_by(ar = year(date)) |> \n      summarise(cpi = mean(cpi),\n                .groups = \"drop\") |> \n      mutate(cpi = cpi / cpi[ar == max(ar)]),\n    by = \"ar\"\n  ) |> \n  mutate(\n    value = (value / fjoldi) / cpi,\n    index = value / value[ar == min(ar)],\n    text = str_c(\"<b>Tekjutíund: \", tiundarhluti, \"</b>\", \"\\n\",\n                 \"Ár: \", ar, \"\\n\",\n                 \"Heildartekjur (á mann á mánuði): \",\n                 number(value * 1e6 / 12, suffix = \" kr\", big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                 \"Breyting (síðan 1997): \", \n                 ifelse(index >= 1, \"+\", \"\"),\n                 percent(index - 1, accuracy = 0.01, big.mark = \".\", decimal.mark = \",\")\n    )\n  )\n\np <- plot_dat |> \n  ggplot(aes(ar, index, text = text)) +\n  geom_hline(yintercept = 1, lty = 2) +\n  geom_line(aes(group = tiundarhluti, col = tiundarhluti)) +\n  scale_x_continuous() +\n  scale_y_log10(\n    labels = function(x) percent(x - 1),\n    breaks = c(\n      1, 1.25, 1.5, 2, 3,\n      1/1.25, 1/1.5, 1/2, 1/3\n    )\n  ) +\n  scale_colour_distiller(type = \"div\", palette = \"RdYlBu\", direction = 1) +\n  theme(legend.position = \"none\") +\n  labs(x = NULL,\n       y = NULL,\n       title = \"Breyting á kaupmætti heildartekna frá 1997\")\n\nggplotly(\n  p,\n  tooltip = \"text\"\n) |> \n  layout(\n    hoverlabel = list(align = \"left\")\n  ) |> \n  config(displayModeBar = FALSE)"
  },
  {
    "objectID": "greinar/skattagogn/index.html#kaupmáttur-ráðstöfunartekna",
    "href": "greinar/skattagogn/index.html#kaupmáttur-ráðstöfunartekna",
    "title": "Tekjur, skattar og kaupmáttur",
    "section": "Kaupmáttur ráðstöfunartekna",
    "text": "Kaupmáttur ráðstöfunartekna\nVið höfum frekar áhuga á kaupmætti ráðstöfunartekna (heildartekjur að frádegnum sköttum).\n\n\nCode\nplot_dat <- d |> \n  filter(tiundarbreyta == \"Ráðstöfunartekjur\",\n         name %in% c(\"Ráðstöfunartekjur (Tekjur - Skattar)\", \"Fjöldi í hóp\")) |> \n  pivot_wider() |> \n  rename(fjoldi = \"Fjöldi í hóp\") |> \n  pivot_longer(c(-ar, -tiundarbreyta, -tiundarhluti, -fjoldi)) |> \n  group_by(ar, name) |> \n  mutate(p = value / sum(value)) |> \n  ungroup() |> \n  select(-tiundarbreyta) |> \n  inner_join(\n    vnv() |> \n      group_by(ar = year(date)) |> \n      summarise(cpi = mean(cpi),\n                .groups = \"drop\") |> \n      mutate(cpi = cpi / cpi[ar == max(ar)]),\n    by = \"ar\"\n  ) |> \n  mutate(\n    value = (value / fjoldi) / cpi,\n    index = value / value[ar == min(ar)],\n    text = str_c(\"<b>Tekjutíund: \", tiundarhluti, \"</b>\", \"\\n\",\n                 \"Ár: \", ar, \"\\n\",\n                 \"Ráðstöfunartekjur (á mann á mánuði): \", \n                 number(value * 1e6 / 12, suffix = \" kr\", big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                 \"Breyting (síðan 1997): \", \n                 ifelse(index >= 1, \"+\", \"\"),\n                 percent(index - 1, accuracy = 0.01, big.mark = \".\", decimal.mark = \",\")\n    )\n  )\n\np <- plot_dat |> \n  ggplot(aes(ar, index, text = text)) +\n  geom_hline(yintercept = 1, lty = 2) +\n  geom_line(aes(group = tiundarhluti, col = tiundarhluti)) +\n  scale_x_continuous() +\n  scale_y_log10(\n    labels = function(x) percent(x - 1),\n    breaks = c(\n      1, 1.25, 1.5, 2, 3,\n      1/1.25, 1/1.5, 1/2, 1/3\n    )\n  ) +\n  scale_colour_distiller(type = \"div\", palette = \"RdYlBu\", direction = 1) +\n  theme(legend.position = \"none\") +\n  labs(x = NULL,\n       y = NULL,\n       title = \"Breyting á kaupmætti ráðstöfunartekna frá 1997\")\n\nggplotly(\n  p,\n  tooltip = \"text\"\n) |> \n  layout(\n    hoverlabel = list(align = \"left\")\n  ) |> \n  config(displayModeBar = FALSE)"
  },
  {
    "objectID": "greinar/skattagogn/index.html#skattbyrði-1",
    "href": "greinar/skattagogn/index.html#skattbyrði-1",
    "title": "Tekjur, skattar og kaupmáttur",
    "section": "Skattbyrði",
    "text": "Skattbyrði\nÞað er líka áhugavert að skoða breytingu í skattbyrði milli 1997 og 2021. Hér þýðir jákvæð prósenta að skattbyrði hefur aukist, en neikvæð prósenta að hún sé minni. Við sjáum að skattbyrði hefur aukist hjá öllum tekjutíundunum nema þeirri efstu. Hér erum við að skoða skattbyrði hvers hóps í heild sinni, þannig að það getur alltaf verið að þetta passi ekki við hvern og einn einstakling, heldur á þetta við um meðaltal allra einstaklinganna.\n\n\nCode\nplot_dat <- d |>\n  filter(tiundarbreyta %in% \"Heildartekjur\",\n         name %in% c(\"Tekjur alls\", \n                     \"Skattar alls\",\n                     \"Fjöldi í hóp\")) |> \n  pivot_wider() |> \n  rename(fjoldi = \"Fjöldi í hóp\") |> \n  janitor::clean_names() |> \n  mutate(\n    value = skattar_alls / tekjur_alls,\n    index = value - value[ar == min(ar)],\n    text = str_c(\"<b>Tekjutíund: \", tiundarhluti, \"</b>\", \"\\n\",\n                 \"Ár: \", ar, \"\\n\",\n                 \"Skattbyrði: \", \n                 percent(value, accuracy = 0.01, big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                 \"Breyting (síðan 1997): \", \n                 ifelse(index >= 0, \"+\", \"\"),\n                 percent(index, accuracy = 0.01, big.mark = \".\", decimal.mark = \",\", suffix = \"%-stig\")\n    )\n  )\n\np <- plot_dat |> \n  ggplot(aes(ar, index, text = text)) +\n  geom_hline(yintercept = 0, lty = 2) +\n  geom_line(aes(group = tiundarhluti, col = tiundarhluti)) +\n  scale_x_continuous() +\n  scale_y_continuous(\n    labels = label_percent(suffix = \"%-stig\")\n  ) +\n  scale_colour_distiller(type = \"div\", palette = \"RdYlBu\", direction = 1) +\n  theme(legend.position = \"none\") +\n  labs(x = NULL,\n       y = NULL,\n       title = \"Breyting á skattbyrði miðað við 1997\")\n\nggplotly(\n  p,\n  tooltip = \"text\"\n) |> \n  layout(\n    hoverlabel = list(align = \"left\")\n  ) |> \n  config(displayModeBar = FALSE)\n\n\n\n\n\n\n\n\nCode\np <- plot_dat |> \n  ggplot(aes(ar, index)) +\n  geom_hline(yintercept = 0, lty = 2) +\n  geom_line(aes(group = tiundarhluti, col = tiundarhluti)) +\n  geom_rangeframe() +\n  geom_text(\n    data = plot_dat |> \n      filter(ar == max(ar)) |> \n      mutate(\n        index = case_when(\n          tiundarhluti == 1 ~ index + 0.0022,\n          tiundarhluti == 8 ~ index - 0.0022,\n          TRUE ~ index\n        )\n      ),\n    aes(col = tiundarhluti, label = str_c(tiundarhluti, \". tíund\")), \n    hjust = 0, \n    nudge_x = 0.2\n  ) +\n  scale_x_tufte(\n    breaks = seq(1997, 2021, by = 3),\n    limits = c(1997, 2023)\n  ) +\n  scale_y_tufte(\n    labels = label_percent(suffix = \"%-stig\", decimal.mark = \",\", big.mark = \".\"),\n    breaks = tufte_breaks(plot_dat$index)\n  ) +\n  scale_colour_distiller(type = \"div\", palette = \"RdYlBu\", direction = 1) +\n  theme(\n    legend.position = \"none\",\n    plot.background = element_blank(),\n    panel.background = element_blank()\n  ) +\n  labs(x = NULL,\n       y = NULL,\n       colour = \"Tekjutíund\",\n       title = \"Breyting á skattbyrði miðað við 1997\",\n       subtitle = \"Skattbyrði hefur aukist hjá öllum tekjutíundum nema þeirri hæstu\",\n       caption = \"Mynd frá bggj.is byggð á skattframtalsgögnum Hagstofunnar\")\n\nggsave(p, filename = \"image.png\",\n       width = 8, height = 0.621 * 8, scale = 1.3)\n\nggsave(\n  p +\n    theme(plot.background = element_blank(),\n          panel.background = element_blank()),\n  filename = \"image_fp.png\",\n  width = 8,\n  height = 0.621 * 8,\n  scale = 1.3\n)"
  },
  {
    "objectID": "greinar/loftgaedi/index.html",
    "href": "greinar/loftgaedi/index.html",
    "title": "Loftgæði",
    "section": "",
    "text": "Á vef Umhverfisstofnunar er skrifað:\n\nÍ stórum þéttbýliskjörnum getur styrkur köfnunarefnisoxíða nálgast mörkin þar sem áhrifa á heilsu manna fer að gæta. Köfnunarefnisdíoxíð (NO2) ertir lungu manna og dýra og meðal annars er talið að langvarandi álag á lungu af völdum NO2 geti valdið lungnaskemmdum síðar á ævinni. Enn fremur getur hár styrkur köfnunarefnisoxíða orsakað plöntuskemmdir.\n\n\nVegna legu Reykjavíkur við hafið og hve vindasamt er þar, er meðalstyrkur köfnunarefnisdíoxíðs sjaldan meiri en 20 µg/m3 á veturna. En þegar logn er á veturna getur myndast mjög greinilegt slör af menguðu lofti yfir borginni og þá fer magn köfnunarefnisdíoxíðs á sólarhring stundum yfir viðmiðunarmörkin sem eru 75 µg/m3.\n\nÁ myndinni að neðan sjáum við hversu oft og hvenær mælingar köfnunarefnisdíoxíðs (NO2) hafa farið yfir hættumörkin, bæði hvað varðar klukkustundarmörk og dagsmörk, síðan 2019."
  },
  {
    "objectID": "greinar/vinnuafl/index.html",
    "href": "greinar/vinnuafl/index.html",
    "title": "Vinnumarkaður",
    "section": "",
    "text": "Code\nif (!file.exists(\"data/vinnuafl.csv\")) {\n  url <- \"https://px.hagstofa.is:443/pxis/api/v1/is/Samfelag/vinnumarkadur/vinnuaflskraargogn/VIN10052.px\"\n  \n  px_vars <- pxweb_get(url)\n  \n  query_list <- list(  \n    \"Mánuður\" = c(\"*\"),  \n    \"Aldur\" = c(\"0\"),  \n    \"Rekstrarform\" = c(\"*\"),  \n    \"Kyn\" = c(\"0\"),  \n    \"Bakgrunnur\" = c(\"*\"),  \n    \"Lögheimili\" = c(\"0\")\n    \n  )\n  \n  d <- pxweb_get(url, query = pxweb_query(query_list), verbose = FALSE) |>  \n    as.data.frame() |>  \n    as_tibble() |>  \n    janitor::clean_names() |>  \n    separate(manudur, into = c(\"ar\", \"manudur\"), sep = \"M\") |>  \n    mutate(dags = str_c(ar, \"-\", manudur, \"-01\") |> ymd()) |>  \n    select(dags, kyn, rekstrarform, starfandi, bakgrunnur) |>  \n    drop_na() |>  \n    mutate(tegund = case_when(str_detect(rekstrarform, \"^B2\") ~ \"Opinbert\",\n                              str_detect(rekstrarform, \"^K1\") ~ \"Opinbert\",  \n                              str_detect(rekstrarform, \"^K2\") ~ \"Opinbert\",  \n                              TRUE ~ \"Annad\")) |> \n    select(-kyn)\n  \n  d |> \n    write_csv(\"data/vinnuafl.csv\")\n} else {\n  d <- vroom::vroom(\"data/vinnuafl.csv\")\n}\n\n\nRows: 7888 Columns: 5\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (3): rekstrarform, bakgrunnur, tegund\ndbl  (1): starfandi\ndate (1): dags\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n\n\n\nCode\nplot_dat <-  d |>  \n  filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n  count(dags, tegund, wt = starfandi) |>  \n  pivot_wider(names_from = tegund, values_from = n) |>  \n  filter(year(dags) >= 2008)\n\np1 <- plot_dat |> \n  ggplot(aes(dags, Annad)) +  \n  geom_line() +  \n  scale_x_date(date_breaks = \"2 year\", date_labels = \"%Y\",   \n               expand = expansion(add = 31),\n               limits = c(min(plot_dat$dags), max(plot_dat$dags) + 15)) +  \n  scale_y_tufte(breaks = tufte_breaks(plot_dat$Annad),\n                limits = c(1e5, 1.5e5),\n                labels = label_number()) +\n  labs(x = NULL,\n       y = NULL,\n       subtitle = \"Almennur\") +\n  theme(plot.margin = margin(t = 5, r = 20, b = 5, l = 5))\n\n\nplot_dat <-  d |>  \n  filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n  count(dags, tegund, wt = starfandi) |>  \n  pivot_wider(names_from = tegund, values_from = n)\n\np2 <- plot_dat |> \n  ggplot(aes(dags, Opinbert)) +  \n  geom_line() +  \n  scale_x_date(date_breaks = \"2 year\", date_labels = \"%Y\",   \n               expand = expansion(add = 31),\n               limits = c(min(plot_dat$dags), max(plot_dat$dags) + 15)) +  \n  scale_y_tufte(breaks = tufte_breaks(plot_dat$Opinbert),\n                labels = label_number()) +\n  labs(x = NULL,\n       y = NULL,\n       subtitle = \"Opinber\") +\n  theme(plot.margin = margin(t = 5, r = 20, b = 5, l = 5))\n\nplot_dat <-  d |>  \n  filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n  count(dags, tegund, wt = starfandi) |>  \n  mutate(tegund = fct_recode(as_factor(tegund),\n                             \"Opinber\" = \"Opinbert\",\n                             \"Almennur\" = \"Annad\"))\n\np3 <- plot_dat |> \n  ggplot(aes(dags, n)) +  \n  geom_line(aes(col = tegund)) +\n  geom_text(data = plot_dat |> filter(dags == max(dags)),\n            aes(label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n  scale_x_date(date_breaks = \"2 year\", date_labels = \"%Y\",  \n               expand = expansion(add = 31),\n               limits = c(min(plot_dat$dags), max(plot_dat$dags) + 15)) +  \n  scale_y_tufte(breaks = tufte_breaks(plot_dat$n),\n                labels = label_number(),\n                limits = c(0, 1.5e5),\n                expand = expansion()) +\n  scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n  labs(x = NULL,\n       y = NULL,\n       subtitle = \"Almennur og opinber\") +\n  theme(plot.margin = margin(t = 5, r = 60, b = 5, l = 5),\n        legend.position = \"none\")\n\nlayout <- 'ABC'\n\np <- p1 + p3 + p2 +\n  plot_layout(\n    design = layout\n  ) +\n  plot_annotation(\n    title = \"Fjöldi starfsfólks eftir vinnumarkaði\",\n    caption = \"Mynd frá metill.is byggð á gögnum Hagstofu um vinnuafl frá skráargögnum\"\n  )\n\nggsave(\n  plot = p,\n  filename = \"figures/figure1.png\",\n  width = 8, height = 0.3 * 8, scale = 1.7\n)\n\n\n\n\n\nCode\nplot_dat <- d |>  \n  filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n  count(dags, tegund, wt = starfandi) |>  \n  pivot_wider(names_from = tegund, values_from = n) |>  \n  filter(year(dags) >= 2019) |>  \n  mutate(manudur = month(dags)) |>  \n  group_by(manudur) |>  \n  mutate(breyting = Annad - Annad[year(dags) == min(year(dags))]) |> \n  ungroup()\n\np1 <- plot_dat |> \n  ggplot(aes(dags, breyting)) +  \n  geom_vline(xintercept = ymd(c(\"2020-01-01\", \"2021-01-01\", \"2022-01-01\")), lty = 2, alpha = 0.3) +\n  geom_hline(yintercept = 0, lty = 2) +  \n  geom_line() +  \n  scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\",  \n               expand = expansion()) +  \n  scale_y_tufte(breaks = tufte_breaks(plot_dat$breyting),\n                labels = label_number(big.mark = \".\", decimal.mark = \",\"),\n                limits = c(-1.8e4, NA)) +  \n  \n  labs(x = NULL, y = NULL,  \n       subtitle = \"Fjöldi starfandi á almennum vinnumarkaði\") +  \n  theme(plot.margin = margin(t = 5, r = 20, b = 5, l = 5))\n\n\nplot_dat <- d |>  \n  filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n  count(dags, tegund, wt = starfandi) |>  \n  pivot_wider(names_from = tegund, values_from = n) |>  \n  filter(year(dags) >= 2019) |>  \n  mutate(manudur = month(dags),\n         hlutf = Opinbert / (Annad + Opinbert)) |> \n  ungroup() |> \n  group_by(manudur) |>  \n  mutate(breyting = hlutf - hlutf[year(dags) == min(year(dags))]) |> \n  ungroup()\n\np2 <- plot_dat |> \n  ggplot(aes(dags, breyting)) +  \n  geom_vline(xintercept = ymd(c(\"2020-01-01\", \"2021-01-01\", \"2022-01-01\")), lty = 2, alpha = 0.3) +\n  geom_line() +  \n  scale_y_tufte(breaks = tufte_breaks(plot_dat$breyting),\n                labels = label_percent(accuracy = 0.1)) +  \n  scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\",  \n               expand = expansion()) +  \n  labs(x = NULL, y = NULL,  \n       subtitle = \"Hlutfall opinbers starfsfólks\") +  \n  theme(plot.margin = margin(t = 5, r = 20, b = 5, l = 5),\n        plot.title = element_text(face = \"bold\"))\n\np <- p1 + p2 +\n  plot_annotation(\n    title = \"Vinnumarkaður samanborinn við sama mánuð árið 2019\",\n    caption = \"Mynd frá metill.is byggð á gögnum Hagstofu um vinnuafl frá skráargögnum\"\n  )\n\nggsave(\n  plot = p,\n  filename = \"figures/figure2.png\",\n  width = 8, height = 0.3 * 8, scale = 1.8,\n  dpi = 300\n)\n\n\n\n\nÁrstíðaleiðrétt hlutfall opinbers starfsfólks\n\nMyndAðferð\n\n\n\n\nCode\ntheme_set(theme_metill(type = \"standalone\"))\n\nmodel_dat <- d |>  \n  filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n  count(dags, tegund, wt = starfandi) |>  \n  pivot_wider(names_from = tegund, values_from = n) |>  \n  mutate(Heild = Opinbert + Annad) |> \n  filter(year(dags) >= 2008) |>  \n  mutate(manudur = month(dags),\n         timi = as.numeric(as.factor(dags)),\n         hlutf = Opinbert / (Annad + Opinbert)) |> \n  ungroup() \n\nm <- gam(Opinbert ~ s(manudur, bs = \"cc\") + s(timi, bs = \"ad\"), \n         data = model_dat, offset = log(Heild), family = nb(), method = \"REML\")\n\nplot_dat <- emmeans(m, ~ timi + manudur, at = list(timi = model_dat$timi,\n                                                   manudur = 1:12)) |> \n  tidy(type = \"response\") |> \n  group_by(timi) |> \n  mutate(wt = 1 / std.error,\n         wt = wt / sum(wt)) |> \n  summarise(response = sum(response * wt)) |> \n  inner_join(\n    model_dat,\n    by = \"timi\"\n  )\n\n\nopinbert_dat <- gam(Opinbert ~ s(manudur, bs = \"cc\") + s(timi, bs = \"ad\"), data = model_dat,\n                    family = nb(), method = \"REML\") |> \n  emmeans(~ timi, at = list(timi = unique(model_dat$timi))) |> \n  tidy() |> \n  inner_join(\n    model_dat |> \n      distinct(timi, dags)\n  ) |> \n  mutate(change = c(0, diff(estimate)),\n         perc_change = exp(change))\n\n\nJoining with `by = join_by(timi)`\n\n\nCode\nalm_dat <- gam(Annad ~ s(manudur, bs = \"cc\") + s(timi, bs = \"ad\"), data = model_dat,\n               family = nb(), method = \"REML\") |> \n  emmeans(~ timi, at = list(timi = unique(model_dat$timi))) |> \n  tidy() |> \n  inner_join(\n    model_dat |> \n      distinct(timi, dags)\n  ) |> \n  mutate(change = c(0, diff(estimate)),\n         perc_change = exp(change))\n\n\nJoining with `by = join_by(timi)`\n\n\nCode\nheild_dat <- gam(Heild ~ s(manudur, bs = \"cc\") + s(timi, bs = \"ad\"), data = model_dat,\n                 family = nb(), method = \"REML\") |> \n  emmeans(~ timi, at = list(timi = unique(model_dat$timi))) |> \n  tidy() |> \n  inner_join(\n    model_dat |> \n      distinct(timi, dags)\n  ) |> \n  mutate(change = c(0, diff(estimate)),\n         perc_change = exp(change))\n\n\nJoining with `by = join_by(timi)`\n\n\nCode\nplot_dat2 <- alm_dat |> \n  mutate(tegund = \"Almennur\") |> \n  bind_rows(\n    opinbert_dat |> \n      mutate(tegund = \"Opinber\")\n  )\n\n\ndates <- c(\"2009-07-01\", \"2017-10-01\", \"2020-12-01\")\n\np1 <- plot_dat |> \n  ggplot(aes(dags, hlutf)) +  \n  geom_vline(xintercept = ymd(dates), lty = 2, alpha = 0.5) +\n  geom_line(aes(y = hlutf), alpha = 0.1) +\n  geom_line(aes(y = response)) +  \n  scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n               date_labels = \"%Y\",  \n               guide = guide_axis(n.dodge = 1),  \n               expand = expansion(),\n               limits = c(min(plot_dat$dags), max(plot_dat$dags) + 20)) +\n  scale_y_tufte(breaks = tufte_breaks(plot_dat$hlutf),\n                labels = label_percent(accuracy = 0.01)) +  \n  labs(x = NULL, y = NULL,  \n       title = \"Breytist hlutfall opinbers starfsfólks vegna opinbers eða almenns markaðar?\",\n       subtitle = \"Hlutfall opinbers starfsfólks af vinnumarkaði\") +  \n  theme(plot.margin = margin(t = 5, r = 60, b = 5, l = 5),\n        axis.line.x = element_blank(),\n        axis.text.x = element_blank(),\n        axis.ticks.x = element_blank())\n\np2 <- plot_dat2 |> \n  ggplot(aes(dags, perc_change)) +\n  geom_vline(xintercept = ymd(dates), lty = 2, alpha = 0.5) +\n  geom_hline(yintercept = 1, lty = 2) +\n  geom_line(aes(col = tegund)) +\n  geom_text(\n    data = plot_dat2 |> \n      filter(dags == max(dags)) |> \n      mutate(\n        y = case_when(\n          tegund == \"Opinber\" ~ perc_change - 0.0004,\n          tegund == \"Almennur\" ~ perc_change + 0.0003,\n        )\n      ),\n    aes(y = y, label = tegund, col = tegund),\n    hjust = 0, nudge_x = 20\n  ) +\n  scale_x_date(date_breaks = \"year\", date_labels = \"%Y\", \n               expand = expansion(),\n               limits = c(min(plot_dat$dags), max(plot_dat$dags) + 20)) +\n  scale_y_tufte(labels = function(x) percent(x - 1, prefix = \" \"),\n                breaks = c(1, range(plot_dat2$perc_change), 1.005, 0.995),\n                trans = \"log10\") +\n  scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n  coord_cartesian(clip = \"off\") +\n  theme(plot.margin = margin(t = 0, r = 60, b = 5, l = 5),\n        legend.position = \"none\",\n        plot.subtitle = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0))) +\n  labs(x = NULL,\n       y = NULL,\n       subtitle = \"Mánaðarleg hlutfallsleg breyting fjölda starfsfólks\")\n\n\np <- plot_grid(\n  p1, \n  p2,\n  ncol = 1\n) +\n  theme_metill() +\n  theme(axis.line = element_blank(),\n        plot.margin = margin()) +\n  labs(caption = \"Mynd frá metill.is byggð á gögnum Hagstofu um vinnuafl frá skráargögnum\")\n\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family\n'Lato' not found in PostScript font database\n\n\nCode\nggsave(\n  plot = p,\n  filename = \"figures/hlutf_opinbert.png\",\n  width = 8, \n  height = 0.621 * 8, \n  scale = 1.3\n)\n\n\np <- plot_grid(\n  p1 +\n    theme(plot.background = element_blank(),\n          panel.background = element_blank()), \n  p2 +\n    theme(plot.background = element_blank(),\n          panel.background = element_blank()),\n  ncol = 1\n) +\n  labs(caption = \"Mynd frá metill.is byggð á gögnum Hagstofu um vinnuafl frá skráargögnum\")\n\nggsave(\n  plot = p ,\n  filename = \"figures/hlutf_opinbert_fp.png\",\n  width = 8, \n  height = 0.621 * 8, \n  scale = 1.3\n)\n\n\n\n\n\n\nLeiðrétting fyrir árstíðarsveiflumTeljarinn og nefnarinn\n\n\nVið getum hugsað að þetta séu tvö ferli:\n\nLangtímaferli sem breytist án mjög ákveðins mynsturs\nÁrstíðabundnar sveiflur sem eru að mestu leyti svipaðar frá ári til árs\n\nNotum GAM (Generalized Additive Models) til að meta bæði ferlin saman. Splæsibrúunin (e. splines) metur ferlið í tveimur hlutum, línulegum og ólínulegum, og notar stika til að toga ólínulega hlutann í átt að línulegu ferli.\n\nÞar sem hæga þróunin getur verið að breytast mishratt á mismunandi árabilum notum við aðlögunarsplæsibrúun (e. adaptive smoother) þar sem ólínulegi stikinn fær að breytast með tíma. Í kóðanum er þetta táknað með s(timi, bs = \"ad\")\nÁrstíðarferlið hefur þær skorður að frávikið í upphafi og byrjun ársins á að stefna í sömu tölu, þ.e. \\(\\text{31. desember} \\approx \\text{1. janúar}\\). Pakkinn mgcv býður upp á slíka hringrásarsplæsara (e. cyclic smooths) [alveg í ruglinu með íslenskuna núna]. Í kóðanum er þetta táknað með s(manudur, bs = \"cc\")\n\nÞegar við erum komin með mat á þessi tvö ferli er lítið mál að heilda yfir árstíðarbundnu sveiflurnar. Við vigtum árstíðarbundna matið eftir nákvæmni matsins í hverjum mánuði (einum deilt með staðalvillu matsins) og reiknum svo meðaltal eftir því.\nAllt í allt metum við þá líkanið svona (einfölduð útgáfa af kóða):\ngam(Opinbert ~ s(manudur, bs = \"cc\") + s(timi, bs = \"ad\"), offset = log(Heild), family = nb())\nFjöldi opinbers starfsfólks er jákvæð fjöldatala svo fyrsta ágískunin er alltaf neikvæða tvíkostadreifingin. Við metum líkanið á lograkvarða, bæði því það er náttúrulega matið fyrir dreifinguna, en líka því við búumst við því að útkoman breytist hlutfallslega milli ára.\nHér fyrir neðan sjáum við svo matið á árstíðaráhrifum:\n\n\nCode\nplot_dat <- emmeans(m, ~ manudur, at = list(manudur = seq(1, 12, length.out = 100))) |> \n  tidy(type = \"response\") |> \n  mutate(response = exp(log(response) - mean(log(response))))\n\nplot_dat |> \n  ggplot(aes(manudur, response)) +\n  geom_hline(yintercept = 1, lty = 2) +\n  geom_line() +\n  scale_x_tufte(breaks = 1:12,\n                labels = c(\"Janúar\", \"Febrúar\", \"Mars\",\n                           \"Apríl\", \"Maí\", \"Júní\",\n                           \"Júli\", \"Ágúst\", \"September\",\n                           \"Október\", \"Nóvember\", \"Desember\")) +\n  scale_y_tufte(labels = function(x) percent(x - 1),\n                breaks = tufte_breaks(plot_dat$response),\n                limits = c(0.92, 1.08)) +\n  labs(x = \"Mánuður\",\n       y = \"Árstíðarbundnar sveiflur\",\n       title = \"Árstíðarsveiflur í hlutfalli opinbers starfsfólks\")\n\n\n\n\n\n\n\nHlutall (p) opinbers starfsfólks (O) af heildarfjölda starfsfólks (H) má skrifa\n\\[\np = \\frac{O}{H},\n\\]\nÞar sem \\(H\\) inniheldur líka starfsfólk á almennum vinnumarkaði (A), s.s. \\(H = O + A\\).\nSkoðum hlutfallið á tveimur mismunandi tímapunktum, \\(p_1\\) og \\(p_2\\).\n\\[\n\\frac{p_2}{p_1} = \\frac{O_2/H_2}{O_1/H_1} = \\frac{O_2/O_1}{H_2/H_1}.\n\\]\nEf \\(p_2 > p_1\\) og \\(p_1 \\neq 0\\) gildir að \\(p_2/p_1 > 1\\) og því\n\\[\n\\begin{aligned}\n\\frac{O_2/O_1}{H_2/H_1} &> 1 \\\\\n\\rightarrow \\frac{O_2}{O_1} &> \\frac{H_2}{H_1},\n\\end{aligned}\n\\]\nþ.e. fjöldi opinbers starfsfólks hefur vaxið hlutfallslega hraðar en fjöldi starfsfólks alls.\nÞetta er kannski augljóst, en það er gott að hafa þetta í huga þegar hlutfallið hækkar og athuga hvort það sé vegna mikilla opinberra ráðninga eða fækkunar starfa á almennum vinnumarkaði.\nHér nota ég GAM til að smootha gögnin og nota svo árstíðaleiðrétt smooth gögn til að reikna stöðugar mánaðarlegar breytingar og teiknum þær svo.\n\n\n\n\n\n\n\nHrein breytingEftir bakgrunniHlutfallsleg breytingEftir bakgrunni\n\n\n\n\nCode\nplot_dat <- d |>  \n  filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n  count(dags, tegund, wt = starfandi) |>  \n  pivot_wider(names_from = tegund, values_from = n) |> \n  mutate(Heild = Annad + Opinbert) |> \n  pivot_longer(c(-dags), names_to = \"tegund\", values_to = \"n\") |> \n  filter(year(dags) >= 2008) |>  \n  mutate(manudur = month(dags)) |>\n  group_by(manudur, tegund) |>  \n  mutate(breyting = c(0, diff(n)),\n         uppsofnud_breyting = cumsum(breyting)) |> \n  ungroup() |> \n  filter(year(dags) > min(year(dags))) |> \n  mutate(tegund = fct_recode(tegund,\n                             \"Almennur\" = \"Annad\",\n                             \"Opinber\" = \"Opinbert\") |> \n           fct_relevel(\"Almennur\", \"Opinber\"))\n\np <- plot_dat |> \n  ggplot(aes(dags, breyting)) +  \n  # geom_vline(xintercept = ymd(seq.Date(from = min(plot_dat$dags),\n  #                                      to = ymd(\"2022-01-01\"),\n  #                                      by = \"year\")), lty = 2, alpha = 0.1) +\n  geom_hline(yintercept = 1, lty = 2, alpha = 0.6) +\n  geom_line(aes(col = tegund)) +  \n  geom_text(data = plot_dat |> filter(dags == max(dags)),\n            aes(label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n  scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n               date_labels = \"%Y\",  \n               guide = guide_axis(n.dodge = 1),  \n               expand = expansion(),\n               limits = c(min(plot_dat$dags), ymd(\"2023-10-01\"))) +  \n  scale_y_tufte(labels = label_number(big.mark = \".\", decimal.mark = \",\"),\n                breaks = tufte_breaks(plot_dat$breyting)) +  \n  scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n  # coord_cartesian(ylim = c(0.84, 1.127)) +\n  labs(x = NULL, y = NULL,  \n       title = \"Hrein árleg breyting á fjölda starfsfólks á vinnumarkaði (2009 - 2022)\",\n       subtitle = \"Y-ás táknar mun á fjölda vinnandi frá sama mánuði á síðasta ári\",\n       caption = \"Mynd frá metill.is byggð á gögnum Hagstofu um vinnuafl frá skráargögnum\") + \n  theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n        legend.position = \"none\")\n\nggsave(\n  plot = p ,\n  filename = \"figures/hrein_breyting.png\",\n  width = 8, \n  height = 0.621 * 8, \n  scale = 1.3\n)\n\n\n\n\n\n\n\nCode\nplot_dat <- d |>  \n  filter(rekstrarform != \"Alls starfandi\") |>  \n  count(dags, tegund, bakgrunnur, wt = starfandi) |>  \n  pivot_wider(names_from = tegund, values_from = n) |> \n  mutate(Heild = Annad + Opinbert) |> \n  pivot_longer(c(-dags, -bakgrunnur), names_to = \"tegund\", values_to = \"n\") |> \n  filter(year(dags) >= 2008) |>  \n  mutate(manudur = month(dags)) |>\n  group_by(manudur, tegund, bakgrunnur) |>  \n  mutate(breyting = c(0, diff(n)),\n         uppsofnud_breyting = cumsum(breyting)) |> \n  ungroup() |> \n  filter(year(dags) > min(year(dags))) |> \n  mutate(tegund = fct_recode(tegund,\n                             \"Almennur\" = \"Annad\",\n                             \"Opinber\" = \"Opinbert\")|> \n           fct_relevel(\"Almennur\", \"Opinber\"),\n         y = breyting)\n\np1 <- plot_dat |> \n  filter(bakgrunnur == \"Íslenskur bakgrunnur\") |> \n  ggplot(aes(dags, breyting)) +  \n  geom_line(data = tibble(x = range(plot_dat$dags), y = c(0, 0)),\n            aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes = FALSE) +\n  geom_line(aes(col = tegund)) +  \n  ggrepel::geom_text_repel(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Íslenskur bakgrunnur\"),\n                           aes(y = y, label = tegund, col = tegund),\n                           hjust = 0, nudge_x = 20, direction = \"y\", force_pull = 1, box.padding = 0.1, max.overlaps = 3) +\n  geom_rangeframe(sides = \"l\") +  \n  scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n               date_labels = \"%b/%Y\",  \n               guide = guide_axis(n.dodge = 1),  \n               expand = expansion(),\n               limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n  scale_y_continuous(labels = label_number(),\n                     breaks = c(0, range(plot_dat$breyting[plot_dat$bakgrunnur == \"Íslenskur bakgrunnur\"])),\n                     limits = range(plot_dat$breyting[plot_dat$bakgrunnur == \"Íslenskur bakgrunnur\"]), \n                     oob = oob_keep) +  \n  scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n  facet_grid(bakgrunnur ~ .) +\n  labs(x = NULL, y = NULL,\n       title = \"Hrein árleg breyting á fjölda starfsfólks á vinnumarkaði (2009 - 2022)\",\n       subtitle = \"Y-ás táknar mun á fjölda vinnandi frá sama mánuði árið á undan\",) +  \n  coord_cartesian(clip = \"off\") +\n  theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n        legend.position = \"none\",\n        axis.line = element_blank(),\n        axis.text.x = element_blank(),\n        axis.ticks.x = element_blank())\n\np2 <- plot_dat |> \n  filter(bakgrunnur == \"Innflytjendur\") |> \n  ggplot(aes(dags, breyting)) +  \n  geom_line(data = tibble(x = range(plot_dat$dags), y = c(0, 0)),\n            aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes = FALSE) +\n  geom_line(aes(col = tegund)) +  \n  ggrepel::geom_text_repel(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Innflytjendur\"),\n                           aes(y = y, label = tegund, col = tegund),\n                           hjust = 0, nudge_x = 20, direction = \"y\", force_pull = 1, box.padding = 0.1, max.overlaps = 3) +\n  geom_rangeframe(sides = \"l\") +  \n  scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n               date_labels = \"%b/%Y\",  \n               guide = guide_axis(n.dodge = 1),  \n               expand = expansion(),\n               limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n  scale_y_continuous(labels = label_number(),\n                     breaks = c(0, range(plot_dat$breyting[plot_dat$bakgrunnur == \"Innflytjendur\"])),\n                     limits = range(plot_dat$breyting[plot_dat$bakgrunnur == \"Innflytjendur\"]),\n                     oob = oob_keep) +  \n  scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n  facet_grid(bakgrunnur ~ .) +\n  labs(x = NULL, y = NULL) +  \n  coord_cartesian(clip = \"off\") +\n  theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 9),\n        legend.position = \"none\",\n        axis.line = element_blank(),\n        axis.text.x = element_blank(),\n        axis.ticks.x = element_blank())\n\np3 <- plot_dat |> \n  filter(bakgrunnur == \"Alls\") |> \n  ggplot(aes(dags, breyting)) +  \n  geom_line(data = tibble(x = range(plot_dat$dags), y = c(0, 0)),\n            aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes = FALSE) +\n  geom_line(aes(col = tegund)) +  \n  ggrepel::geom_text_repel(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Alls\"),\n                           aes(y = y, label = tegund, col = tegund),\n                           hjust = 0, nudge_x = 20, direction = \"y\", force_pull = 1, box.padding = 0.1, max.overlaps = 3) +\n  geom_rangeframe() +  \n  scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n               date_labels = \"%Y\",  \n               guide = guide_axis(n.dodge = 1),  \n               expand = expansion(),\n               limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n  scale_y_continuous(labels = label_number(),\n                     breaks = c(range(plot_dat$breyting), 0),\n                     limits = range(plot_dat$breyting),\n                     oob = oob_keep) +  \n  scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n  facet_grid(bakgrunnur ~ .) +\n  labs(x = NULL, y = NULL,) +  \n  coord_cartesian(clip = \"off\") +\n  theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n        legend.position = \"none\",\n        axis.line = element_blank())\n\np <- plot_grid(p1, p2, p3, ncol = 1, rel_heights = c(1, 0.85, 1)) +\n  theme_metill() +\n  theme(axis.line = element_blank()) +\n  labs(caption = \"Mynd frá metill.is byggð á gögnum Hagstofu um vinnuafl frá skráargögnum\")\n\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\n\nCode\nggsave(\n  plot = p ,\n  filename = \"figures/hrein_breyting_saman.png\",\n  width = 8, \n  height = 0.8 * 8, \n  scale = 1.3\n)\n\n\n\n\n\n\n\nCode\nplot_dat <- d |>  \n  filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n  count(dags, tegund, wt = starfandi) |>  \n  pivot_wider(names_from = tegund, values_from = n) |> \n  mutate(Heild = Annad + Opinbert) |> \n  pivot_longer(c(-dags), names_to = \"tegund\", values_to = \"n\") |> \n  filter(year(dags) >= 2008) |>  \n  mutate(manudur = month(dags)) |>\n  group_by(manudur, tegund) |>  \n  mutate(breyting = c(1, exp(diff(log(n)))),\n         uppsofnud_breyting = exp(cumsum(log(breyting)))) |> \n  ungroup() |> \n  filter(year(dags) > min(year(dags))) |> \n  mutate(tegund = fct_recode(tegund,\n                             \"Almennur\" = \"Annad\",\n                             \"Opinber\" = \"Opinbert\")|> \n           fct_relevel(\"Almennur\", \"Opinber\"))\n\np <- plot_dat |> \n  ggplot(aes(dags, breyting)) +  \n  # geom_vline(xintercept = ymd(seq.Date(from = min(plot_dat$dags),\n  #                                      to = ymd(\"2022-01-01\"),\n  #                                      by = \"year\")), lty = 2, alpha = 0.1) +\n  geom_hline(yintercept = 1, lty = 2, alpha = 0.6) +\n  geom_line(aes(col = tegund)) +  \n  geom_text(data = plot_dat |> filter(dags == max(dags)),\n            aes(label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n  scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n               date_labels = \"%Y\",  \n               guide = guide_axis(n.dodge = 1),  \n               expand = expansion(),\n               limits = c(min(plot_dat$dags), ymd(\"2023-10-01\"))) +  \n  scale_y_tufte(breaks = tufte_breaks(plot_dat$breyting),\n                labels = function(x) percent(x - 1),\n                trans = \"log10\") +  \n  scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n  coord_cartesian(ylim = c(0.84, 1.13)) +\n  labs(x = NULL, y = NULL,  \n       title = \"Hlutfallsleg árleg breyting á fjölda starfsfólks á vinnumarkaði (2009 - 2022)\",\n       subtitle = \"Y-ás er á lograkvarða svo að -50% og +100% eru jafnlangt frá 0% breytingu\",\n       caption = \"Mynd frá metill.is byggð á gögnum Hagstofu um vinnuafl frá skráargögnum\") +   \n  theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n        legend.position = \"none\")\n\nggsave(\n  plot = p ,\n  filename = \"figures/hlutf_breyting.png\",\n  width = 8, \n  height = 0.621 * 8, \n  scale = 1.3\n)\n\n\n\n\n\n\n\nCode\nplot_dat <- d |>  \n  filter(rekstrarform != \"Alls starfandi\") |>  \n  count(dags, tegund, bakgrunnur, wt = starfandi) |>  \n  pivot_wider(names_from = tegund, values_from = n) |> \n  mutate(Heild = Annad + Opinbert) |> \n  pivot_longer(c(-dags, -bakgrunnur), names_to = \"tegund\", values_to = \"n\") |> \n  filter(year(dags) >= 2008) |>  \n  mutate(manudur = month(dags)) |>\n  group_by(manudur, tegund, bakgrunnur) |>  \n  mutate(breyting = c(1, exp(diff(log(n))))) |> \n  ungroup() |> \n  filter(year(dags) > min(year(dags))) |> \n  mutate(tegund = fct_recode(tegund,\n                             \"Almennur\" = \"Annad\",\n                             \"Opinber\" = \"Opinbert\") |> \n           fct_relevel(\"Almennur\", \"Opinber\"),\n         y = breyting,\n         y = case_when(tegund == \"Heild\" ~ y * (1 - 0.015 * (bakgrunnur == \"Innflytjendur\")),\n                       tegund == \"Almennur\" ~ y * 1,\n                       TRUE ~ y))\n\np1 <- plot_dat |> \n  filter(bakgrunnur == \"Íslenskur bakgrunnur\") |> \n  ggplot(aes(dags, breyting)) +  \n  geom_line(data = tibble(x = range(plot_dat$dags), y = c(1, 1)),\n            aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes = FALSE) +\n  geom_line(aes(col = tegund)) +  \n  ggrepel::geom_text_repel(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Íslenskur bakgrunnur\"),\n                           aes(y = y, label = tegund, col = tegund),\n                           hjust = 0, nudge_x = 20, direction = \"y\", force_pull = 1, box.padding = 0.1, max.overlaps = 3) +\n  geom_rangeframe(sides = \"l\") +  \n  scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n               date_labels = \"%b/%Y\",  \n               guide = guide_axis(n.dodge = 1),  \n               expand = expansion(),\n               limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n  scale_y_log10(breaks = c(range(plot_dat$breyting[plot_dat$bakgrunnur == \"Íslenskur bakgrunnur\"], na.rm = T), 1),\n                labels = function(x) percent(x - 1)) +  \n  scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n  facet_grid(bakgrunnur ~ .) +\n  labs(x = NULL, y = NULL,\n       title = \"Hlutfallsleg árleg breyting á fjölda starfsfólks á vinnumarkaði (2009 - 2022)\",\n       subtitle = \"Y-ás er á lograkvarða svo að -50% og +100% eru jafnlangt frá 0% breytingu\") +  \n  coord_cartesian(clip = \"off\") +\n  theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n        legend.position = \"none\",\n        axis.line = element_blank(),\n        axis.text.x = element_blank(),\n        axis.ticks.x = element_blank())\n\np2 <- plot_dat |> \n  filter(bakgrunnur == \"Innflytjendur\") |> \n  ggplot(aes(dags, breyting)) +  \n  geom_line(data = tibble(x = range(plot_dat$dags), y = c(1, 1)),\n            aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes = FALSE) +\n  geom_line(aes(col = tegund)) +  \n  ggrepel::geom_text_repel(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Innflytjendur\"),\n                           aes(y = y, label = tegund, col = tegund),\n                           hjust = 0, nudge_x = 20, direction = \"y\", force_pull = 1, box.padding = 0.1, max.overlaps = 3) +\n  geom_rangeframe(sides = \"l\") +  \n  scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n               date_labels = \"%b/%Y\",  \n               guide = guide_axis(n.dodge = 1),  \n               expand = expansion(),\n               limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n  scale_y_log10(breaks = c(range(plot_dat$breyting[plot_dat$bakgrunnur == \"Innflytjendur\"], na.rm = T), 1),\n                labels = function(x) percent(x - 1)) +  \n  scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n  facet_grid(bakgrunnur ~ .) +\n  labs(x = NULL, y = NULL) +  \n  coord_cartesian(clip = \"off\") +\n  theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 9),\n        legend.position = \"none\",\n        axis.line = element_blank(),\n        axis.text.x = element_blank(),\n        axis.ticks.x = element_blank())\n\np3 <- plot_dat |> \n  filter(bakgrunnur == \"Alls\") |> \n  ggplot(aes(dags, breyting)) +  \n  geom_line(data = tibble(x = range(plot_dat$dags), y = c(1, 1)),\n            aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes = FALSE) +\n  geom_line(aes(col = tegund)) +  \n  ggrepel::geom_text_repel(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Alls\"),\n                           aes(y = y, label = tegund, col = tegund),\n                           hjust = 0, nudge_x = 20, direction = \"y\", force_pull = 1, box.padding = 0.1, max.overlaps = 3) +\n  geom_rangeframe(sides = \"lb\") +  \n  scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n               date_labels = \"%Y\",  \n               guide = guide_axis(n.dodge = 1),  \n               expand = expansion(),\n               limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n  scale_y_log10(breaks = c(range(plot_dat$breyting[plot_dat$bakgrunnur == \"Alls\"], na.rm = T), 1),\n                labels = function(x) percent(x - 1)) +  \n  scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n  facet_grid(bakgrunnur ~ .) +\n  labs(x = NULL, y = NULL,) +  \n  coord_cartesian(clip = \"off\") +\n  theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n        legend.position = \"none\",\n        axis.line = element_blank())\n\np <- plot_grid(p1, p2, p3, ncol = 1, rel_heights = c(1, 0.85, 1)) +\n  theme_metill() +\n  theme(axis.line = element_blank()) +\n  labs(caption = \"Mynd frá metill.is byggð á gögnum Hagstofu um vinnuafl frá skráargögnum\")\n\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\nWarning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font\nfamily 'Lato' not found in PostScript font database\n\n\nCode\nggsave(\n  plot = p ,\n  filename = \"figures/hlutf_breyting_saman.png\",\n  width = 8, \n  height = 0.8 * 8, \n  scale = 1.3\n)\n\n\nWarning: ggrepel: 1 unlabeled data points (too many overlaps). Consider\nincreasing max.overlaps\n\n\nWarning: ggrepel: 1 unlabeled data points (too many overlaps). Consider\nincreasing max.overlaps\n\n\n\n\n\n\n\n\nCode\nplot_dat <- d |> \n  filter(\n    rekstrarform != \"Alls starfandi\"\n  ) |> \n  select(dags, rekstrarform, bakgrunnur, starfandi) |> \n  pivot_wider(names_from = bakgrunnur, values_from = starfandi, values_fill = 0) |> \n  janitor::clean_names() |> \n  mutate(\n    hlutf = innflytjendur / alls,\n    rekstrarform = str_replace(rekstrarform, \"^[A-Z& 0-9,og]+: \", \"\") |> \n      str_to_sentence(),\n    rekstrarform = fct_reorder(rekstrarform, hlutf, .fun = max)\n  ) |> \n  filter(\n    !rekstrarform %in% c(\n      \"Erlend félög\",\n      \"Samvinnufélög\"\n    )\n  )\n\n\np <- plot_dat |> \n  ggplot(aes(dags, hlutf)) +\n  geom_line(\n    data = plot_dat |> rename(reks = rekstrarform),\n    aes(group = reks),\n    alpha = 0.05\n  ) +\n  geom_line(size = 0.5) +\n  scale_x_date(\n    date_breaks = \"3 year\",\n    date_labels = \"%Y\"\n  ) +\n  scale_y_continuous(\n    labels = label_hlutf(),\n    limits = c(0, 0.301),\n    expand = expansion()\n  ) +\n  facet_wrap(\"rekstrarform\") +\n  labs(\n    x = NULL,\n    y = NULL,\n    title = \"Hlutfall starfsfólks af erlendum uppruna\",\n    subtitle = \"Sýnt eftir rekstrarformi án erlendra félaga og samvinnufélaga\",\n    caption = caption\n  )\n\n\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n\n\nCode\nggsave(\n  plot = p,\n  filename = \"Figures/hlutf_erlent.png\",\n  width = 8, height = 0.8 * 8, scale = 1.3\n)"
  },
  {
    "objectID": "um_metil.html",
    "href": "um_metil.html",
    "title": "Metill",
    "section": "",
    "text": "metill no kk\nTölfræðileg uppskrift þar sem innihaldið er gögn og útkoman er einhver ákveðin stærð sem við höfum áhuga á að meta.\n\n\nOrðið metill lýsir markmiði þessarar síðu: Að nota réttu gögnin og góðar uppskriftir til að fá út mat á ýmsum stærðum sem eru partur af umræðunni hverju sinni.\n\nHöfundar\n\n\n\n\n\n\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\nPhD nemandi í tölfræði við HÍ"
  },
  {
    "objectID": "greinar.html",
    "href": "greinar.html",
    "title": "Metill",
    "section": "",
    "text": "Loftgæði\n\n\nSamantekt á mælingum köfnunarefnisdíoxíðs (NO2) við Grensásveg\n\n\nNýlega var fjallað um óvenjulega háar mælingar á NO2 í Reykjavíkurborg. Hversu algeng eru slík tilvik? Hér ber ég mælingar ársins 2023 saman við fyrri ár.\n\n\n\n\n\n\nJan 21, 2023\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\nVinnumarkaður\n\n\nHver er fjöldi starfandi einstaklinga og hvernig skiptast þeir á vinnumarkaði?\n\n\nReglulega sjást fyrirsagnir þar sem talað er um að opinbert starfsfólk sé allt of margt og að hlutfall þess af heildarfjölda vinnandi fólks sé of hátt. Hér kryf ég reglulega nýjustu gögnin til að geta vitað hvort slíkar fullyrðingar séu teknar úr samhengi eða endurspegli raunveruleikann.\n\n\n\n\n\n\nJan 17, 2023\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\nVísitala neysluverðs\n\n\nVísitalan og áhrif undirtalna á heildina unnið úr nýjustu gögnum Hagstofu hverju sinni\n\n\nVerðbólga er ekki alltaf það sama og verðbólga. Stundum er stór hluti af henni hækkun á húsnæðisverði, stundum ferðir og flutningar. Það er því gott að skoða undirvísitölurnar og áhrif þeirra á heildina.\n\n\n\n\n\n\nDec 22, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\nFjármál stjórnmálaflokkanna\n\n\nGreining á ársreikningum stjórnmálaflokka úr gögnum Ríkisendurskoðunar\n\n\nHversu miklar tekjur hafa stjórnmálaflokkarnir og hvaðan koma þær? Hækka útgjöld þeirra sjáanlega í kringum kosningar og eiga þeir einhverjar eignir? Hér köfum við ofan í ársreikninga stjórnmálaflokkanna.\n\n\n\n\n\n\nOct 17, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\nLeikskólar\n\n\nHvernig gengur sveitarfélögum landsins að brúa bilið?\n\n\nHvernig gengur sveitarfélögum að útbúa leikskólapláss? Hvernig ber fjölda nemenda í leikskólum saman við heildarfjölda barna í hverjum árgangi? Hér skoðum við gögn Hagstofunnar um leikskóla og berum saman við mannfjöldatölur eftir aldri.\n\n\n\n\n\n\nOct 5, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\nTekjur, skattar og kaupmáttur\n\n\nGreining á tekjuskattsgögnum sem Hagstofan vinnur úr skattframtölum Íslendinga\n\n\nStundum les maður að skattakerfið ýti undir ójöfnuð, eða að það séu of háir skattar á þeim efnameiru. Hvort er það? Hér nota ég skattagögn Hagstofunnar til að skoða tekjur og skatta eftir tekjutíundum. Ég get ekki sagt hvort það sé sanngjarnt, en ég get sýnt hvernig það hefur breyst með tímanum.\n\n\n\n\n\n\nSep 11, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\nLandspítalinn\n\n\nHvaða upplýsingar eru til um rekstur Landspítalans og hvar má finna þær?\n\n\nHvernig er nýting legurýma á Landspítala? Hvaða hlutfall launa fer í þessi margræddu millistjórnendastörf? Hér ætla ég aðeins að skoða hvaða gögn eru til um rekstur landspítalans, hvar má finna þau og hvað mætti betur fara í birtingu þeirra gagna.\n\n\n\n\n\n\nAug 24, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "learn.html",
    "href": "learn.html",
    "title": "Færslur",
    "section": "",
    "text": "No matching items"
  },
  {
    "objectID": "pyngjan.html",
    "href": "pyngjan.html",
    "title": "Pyngjuhornið",
    "section": "",
    "text": "Fyrstu kaupendur\n\n\nHvernig standa fyrstu kaupendur á fasteignamarkaðinum?\n\n\nSkoðum gögn fasteignaskrár, sem flutti nýlega frá Þjóðskrá til HMS, um fyrstu kaupendur og komumst að því hvort meðalaldur þeirra hafi breyst, hversu stór hluti kaupenda eru fyrstu kaupendur, og hvernig kaupverði ber saman við ráðstöfunartekur ungs fólks.\n\n\n\n\n\n\nNov 25, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\nHáskóli Íslands: Hornkerling?\n\n\nHver eru útgjöld ríkisins til fimm háskóla á Íslandi?\n\n\nVið vitum öll að Háskóli Íslands fær mest útgjöld frá ríkinu, en hvernig ber honum saman við aðra háskóla á hvern nemanda?\n\n\n\n\n\n\nNov 11, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\nFasteignauppbygging\n\n\nHvað byggjum við mikið af fasteignum? Er það nóg fyrir vaxandi mannfjöldann?\n\n\nStundum er talað um að við byggjum of mikið af fasteignum en oftast vill fólk meina að það sé mikill skortur. Hvað byggjum við mikið af fasteignum og hvað erum við mörg? Eru þetta nógu margar fasteignir?\n\n\n\n\n\n\nOct 28, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\nOpinberar veitingar\n\n\nHvaða veitingar eru vinsælastar á fundum og viðburðum ríkisins?\n\n\nAlþingi, ríkisstjórn og ríkið á helst að endurspegla þjóðina í öllum sínum kostum og göllum. Eitt málefni sem er okkur öllum mikilvægt er matur. Hvað finnst okkur gott að borða? Hvar finnst okkur gott að borða? Er ríkið sammála okkur í þessum málum? Hér skoða ég útgjöld ríkisins til veitingastaða, veisluþjónusta og mötuneyta.\n\n\n\n\n\n\nOct 14, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\nStrætó\n\n\nHvað getum við lært af því hvernig Strætó bs. birtir tölurnar sínar?\n\n\nÍ ársreikningi Strætó bs. frá 2021 má finna áhugaverða myndræna framsetningu á tölum. Hér skoða ég hvað við getum lært af þessu og hvernig við getum hjálpað þeim að koma gögnunum ennþá betur til skila.\n\n\n\n\n\n\nSep 30, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\nNo matching items"
  }
]